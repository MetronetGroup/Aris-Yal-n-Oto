{
  "name": "Ã¶zel agent yalÃ§Ä±n oto",
  "nodes": [
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -1776,
        1888
      ],
      "id": "4f4e6396-5d22-4372-a51f-58b06fa3bbec",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "F3qnz7H0QSYVapmS",
          "name": "Ãœcretli Hesap"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.body.data.message.conversation }}",
        "options": {
          "systemMessage": "=Sen bir sanal asistansÄ±n. GÃ¶revin kullanÄ±cÄ±yla etkileÅŸimde bulunmak ve doÄŸru rapor akÄ±ÅŸÄ±nÄ± yÃ¶netmek.\n\n1ï¸âƒ£ KarÅŸÄ±lama MesajÄ± (KullanÄ±cÄ± ilk mesaj gÃ¶nderdiÄŸinde)\n\nKullanÄ±cÄ±ya ÅŸu mesaj gÃ¶sterilecek:\n\nMerhaba {{ $json.body.data.pushName }} ! Ben Aris,  \nSizin iÃ§in yapabileceklerim:\n\nğŸŸ¦A. AbcXyz Analizi Raporu \nğŸŸ¦B. 12 AylÄ±k SatÄ±ÅŸ Analiz Raporu\nğŸŸ¦C. Stok Fifo Raporu  \nğŸŸ¦D. Nakit AkÄ±ÅŸ Raporu   \nğŸŸ¦E. Takvim BazÄ±nda YaÅŸlandÄ±rma Raporu \nğŸŸ¦F. GÃ¼nlÃ¼k Tahsilat/Ã¶demeler Raporu  \nğŸŸ¦G. Plasiyer Borc/Alacak Raporu\nğŸŸ¦H. SipariÅŸ Ã–neri Raporu\n\nHangisini tercih edersiniz?\n\n\n\nTemel Kurallar:\nÄ°lk Mesajda memoryden almayacaksÄ±n aynÄ± ÅŸekilde aÅŸarÄ±daki mesajÄ± olacak \nMerhaba {{ $json.body.data.pushName }} ! Ben Aris,  \nSizin iÃ§in yapabileceklerim:\n\nğŸŸ¦A. AbcXyz Analizi Raporu \nğŸŸ¦B. 12 AylÄ±k SatÄ±ÅŸ Analiz Raporu\nğŸŸ¦C. Stok Fifo Raporu  \nğŸŸ¦D. Nakit AkÄ±ÅŸ Raporu   \nğŸŸ¦E. Takvim BazÄ±nda YaÅŸlandÄ±rma Raporu \nğŸŸ¦F. GÃ¼nlÃ¼k Tahsilat/Ã¶demeler Raporu  \nğŸŸ¦G. Plasiyer Borc/Alacak Raporu\nğŸŸ¦H. SipariÅŸ Ã–neri Raporu\n\n\n\n\n---------------------------------------------------------\nKullanÄ±cÄ± Aâ€“G yazabilir veya raporun tam adÄ±nÄ± yazabilir.\nSeÃ§ilen harf rapor adlarÄ±na ÅŸu ÅŸekilde Ã§evrilir:\n\nÃ–nemli Not : KullanÄ±cÄ±yÄ± Herzaman bir sanki mÃ¼ÅŸteri hizmetleri gibi konuÅŸ\nKod\tRapor AdÄ±\nA\tStoklar iÃ§in AbcXyz Analizi\nB\t12 AylÄ±k SatÄ±ÅŸ Analiz Raporu\nC\tStok Fifo Raporu\nD\tNakit AkÄ±ÅŸ Raporu\nE\tTakvim BazÄ±nda YaÅŸlandÄ±rma Raporu\nF   GÃ¼nlÃ¼k Tahsilat/Ã¶demeler Raporu \nG   Plasiyer Borc/Alacak Raporu\nH   SipariÅŸ Ã–neri Raporu\n\n\n\nğŸ“Œ EÄŸer kullanÄ±cÄ± G ya da â€œGrup BazÄ±nda AylÄ±k Plasiyer SatÄ±ÅŸ Raporu veya Z yada Stok KarlÄ±lÄ±k Analiz Raporu â€ seÃ§tiyse ÅŸu soru sorulacak:\n\nâ€œHangi ay iÃ§in rapor almak istiyorsunuz?â€\n\n3ï¸âƒ£ Ay algÄ±lama kurallarÄ±\n\nKullanÄ±cÄ± ayÄ± yazÄ±yla yazarsa aÅŸaÄŸÄ±daki eÅŸleÅŸme yapÄ±lÄ±r:\n\nOcak â†’ 1\n\nÅubat â†’ 2\n\nMart â†’ 3\n\nNisan â†’ 4\n\nMayÄ±s â†’ 5\n\nHaziran â†’ 6\n\nTemmuz â†’ 7\n\nAÄŸustos â†’ 8\n\nEylÃ¼l â†’ 9\n\nEkim â†’ 10\n\nKasÄ±m â†’ 11\n\nAralÄ±k â†’ 12\n\nKullanÄ±cÄ± 1â€“12 arasÄ±nda bir sayÄ± yazarsa doÄŸrudan ay kabul edilir.\n\nHatalÄ± veya ay iÃ§ermeyen ifade girilirse:\n\n\"ay\": \"GeÃ§erli bir ay bilgisi bulunamadÄ±.\"\n\nğŸ“Œ EÄŸer kullanÄ±cÄ± G ya da â€œPlasiyer Borc/Alacak Raporuâ€ seÃ§tiyse ÅŸu soru sorulacak:\n\nPlasiyer Borc/Alacak Raporunu Hangisi Ä°Ã§in almak istersiniz.\n1.Cari BorÃ§ Alacak\n2.Cari Kartdaki tanÄ±mlÄ± plasiyere gÃ¶re borÃ§ alacak\n3.Cari Hareketlerindeki plasiyere gÃ¶re borÃ§ alacak\n\nKullanÄ±cÄ± 1-3 veya isim olarak hangisini seÃ§erse artÄ±k category adÄ± seÃ§tiÄŸi isim olacak ve output hangsini seÃ§tiyse onu hazÄ±rlÄ±yorum Ã§Ä±ktÄ± vereceksin.\n\nğŸ“Œ EÄŸer kullanÄ±cÄ± A ya da â€œ AbcXyz Analizi Raporuâ€ seÃ§tiyse ÅŸu soru sorulacak:\n\nAbcXyz Raporunu Hangisi Ä°Ã§in almak istersiniz.\n1.Stoklar iÃ§in AbcXyz Analizi \n2.Cariler iÃ§in AbcXyz Analizi \n\nKullanÄ±cÄ± 1-2 veya isim olarak hangisini seÃ§erse artÄ±k category adÄ± seÃ§tiÄŸi isim olacak ve output hangsini seÃ§tiyse onu hazÄ±rlÄ±yorum Ã§Ä±ktÄ± vereceksin.\n\n\n\n4ï¸âƒ£ JSON Ã‡Ä±ktÄ± KurallarÄ±\n\nHer zaman 3 alan bulunacak:\n\ncategory â†’ her zaman kullanÄ±cÄ±nÄ±n seÃ§tiÄŸi rapor adÄ±  \nay â†’ ay numarasÄ± (1â€“12) veya hata mesajÄ±  \nmesaj â†’ \"<category> raporunu sizin iÃ§in hazÄ±rlÄ±yorum\"\n\nâœ… ğŸ”µ Ã–RNEK FÄ°NAL JSON (Ä°STEDÄ°ÄÄ°N FORMAT)\n\nKullanÄ±cÄ±: â€œGâ€\nSonra: â€œMayÄ±sâ€\n\n{\n  \"category\": \"Plasiyer AylÄ±k SatÄ±ÅŸ Raporu\",\n  \"ay\": 5,\n  \"mesaj\": \"Plasiyer AylÄ±k SatÄ±ÅŸ Raporu raporunu sizin iÃ§in hazÄ±rlÄ±yorum\"\n}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -1744,
        1712
      ],
      "id": "cf0bf4c6-afa4-4945-9769-5c032a3b7868",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "jsCode": "// Gelen veriyi al\nconst item = $json.data?.[0] || $json;\n\n// Dinamik olarak tÃ¼m alanlarÄ± stringe Ã§evir\nlet message = \"\";\nfor (const [key, value] of Object.entries(item)) {\n  message += `${key}: ${value}\\n`;\n}\n\n// Sonucu dÃ¶ndÃ¼r\nreturn [\n  {\n    json: {\n      message\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -176,
        1744
      ],
      "id": "78f6253b-1720-42bd-a601-d831efebc2ff",
      "name": "Data Parse"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f0a32bd2-526d-4474-8d63-b5fa413a66d7",
                    "leftValue": "={{ $('Category').item.json.category }}",
                    "rightValue": "Stoklar iÃ§in AbcXyz Analizi",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "abc"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "ad58559a-38fd-45ce-8f71-1a581f7f2bfc",
                    "leftValue": "={{ $('Category').item.json.category }}",
                    "rightValue": "SipariÅŸ Ã–neri Raporu",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "SipariÅŸ Ã–neri Raporu"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6426648f-f620-4cd0-b1e0-3c369ae85c06",
                    "leftValue": "={{ $('Category').item.json.category }}",
                    "rightValue": "Takvim BazÄ±nda YaÅŸlandÄ±rma Raporu",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "=takvimyaslandÄ±rma"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "73fd302a-2049-4a40-94ee-0c54ec7d6315",
                    "leftValue": "={{ $('Category').item.json.category }}",
                    "rightValue": "GÃ¼nlÃ¼k Tahsilat/Ã¶demeler Raporu",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "=GÃ¼nlÃ¼k Tahsilat/Ã¶demeler"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "cc951483-3a34-4484-85ea-807c5563e77d",
                    "leftValue": "={{ $('Category').item.json.category }}",
                    "rightValue": "Cari Hareketlerindeki plasiyere gÃ¶re borÃ§ alacak",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Cari Hareketlerindeki"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8b305ed4-1195-47c1-a0d1-0949cd93585d",
                    "leftValue": "={{ $('Category').item.json.category }}",
                    "rightValue": "Cari Kartdaki tanÄ±mlÄ± plasiyere gÃ¶re borÃ§ alacak",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Cari Kartdaki"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fc81709a-5ed9-401c-a27d-e7d952458d9b",
                    "leftValue": "={{ $('Category').item.json.category }}",
                    "rightValue": "Cari BorÃ§ Alacak",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Cari BorÃ§ Alacak"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "92533fab-03bc-4331-aa06-31d4005928c2",
                    "leftValue": "={{ $('Category').item.json.category }}",
                    "rightValue": "Cariler iÃ§in AbcXyz Analizi",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "cariabcxyz"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "72182d7e-133e-42a1-a6cf-fe7ed5ebdc3f",
                    "leftValue": "={{ $('Category').item.json.category }}",
                    "rightValue": "12 AylÄ±k SatÄ±ÅŸ Analiz Raporu",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "12 AylÄ±k SatÄ±ÅŸ Analiz Raporu"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "c385a55d-cc4c-481e-8965-0baa4d593027",
                    "leftValue": "={{ $('Category').item.json.category }}",
                    "rightValue": "Nakit AkÄ±ÅŸ Raporu",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Nakit AkÄ±ÅŸ Raporu"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -640,
        1680
      ],
      "id": "44aa40a7-e172-4af4-8dc2-151d5b497308",
      "name": "Switch"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.data;\n\n// XML iÃ§in escape fonksiyonu (EN KRÄ°TÄ°K DÃœZELTME)\nfunction xmlEscape(str) {\n  return String(str)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&apos;\");\n}\n\nlet items = [];\nif (Array.isArray(input)) {\n  items = input;\n} else if (typeof input === 'object') {\n  items = [input];\n}\n\nif (items.length === 0) {\n  const debugHtml = `<html><body><h3>Veri bulunamadÄ±</h3><pre>${xmlEscape(JSON.stringify(input,null,2))}</pre></body></html>`;\n  const base64 = Buffer.from(debugHtml, \"utf8\").toString(\"base64\");\n  return [{\n    json: { warning: \"No data found\" },\n    binary: { data: { data: base64, mimeType: \"text/html\", fileName: \"cari_ekstra_debug.html\" } }\n  }];\n}\n\n// --- BaÅŸlÄ±klarÄ± Ã§Ä±kar\nconst headersSet = new Set();\nitems.forEach(obj => Object.keys(obj).forEach(k => headersSet.add(k)));\nconst headers = Array.from(headersSet);\n\n// --- Her sÃ¼tun iÃ§in geniÅŸlik hesapla\nconst columnWidths = headers.map(h => {\n  let maxLen = h.length;\n  for (const item of items) {\n    const val = item[h];\n    if (val !== null && val !== undefined) {\n      maxLen = Math.max(maxLen, val.toString().length);\n    }\n  }\n  return Math.max(50, maxLen * 7);\n});\n\n// --- XML Spreadsheet baÅŸlat\nlet xml = `<?xml version=\"1.0\"?>\n<Workbook xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\n xmlns:o=\"urn:schemas-microsoft-com:office:office\"\n xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\n xmlns:ss=\"urn:schemas-microsoft-com:office:spreadsheet\">\n<Styles>\n  <Style ss:ID=\"DateStyle\">\n    <NumberFormat ss:Format=\"yyyy-mm-dd\"/>\n  </Style>\n  <Style ss:ID=\"CurrencyStyle\">\n    <NumberFormat ss:Format=\"â‚º#,##0.00\"/>\n  </Style>\n  <Style ss:ID=\"NumberStyle\">\n    <NumberFormat ss:Format=\"#,##0.00\"/>\n  </Style>\n</Styles>\n<Worksheet ss:Name=\"TakvimYaslandÄ±rma\">\n<Table>`;\n\n// --- SÃ¼tun geniÅŸliklerini ekle\nfor (const w of columnWidths) {\n  xml += `<Column ss:AutoFitWidth=\"0\" ss:Width=\"${w}\"/>`;\n}\n\n// --- BaÅŸlÄ±k satÄ±rÄ±\nxml += \"<Row>\";\nfor (const h of headers) {\n  xml += `<Cell><Data ss:Type=\"String\">${xmlEscape(h)}</Data></Cell>`;\n}\nxml += \"</Row>\";\n\n// --- Veri satÄ±rlarÄ±\nfor (const item of items) {\n  xml += \"<Row>\";\n\n  for (const h of headers) {\n    let val = item[h];\n    let cellType = \"String\";\n    let style = \"\";\n\n    if (val === null || val === undefined) val = \"\";\n\n    if (typeof val === \"number\") {\n      cellType = \"Number\";\n      style = ' ss:StyleID=\"NumberStyle\"';\n    } else if (typeof val === \"string\") {\n\n      // Tarih kontrolÃ¼\n      if (h.toLowerCase().includes(\"tarih\") && /^\\d{4}-\\d{2}-\\d{2}/.test(val)) {\n        cellType = \"DateTime\";\n        style = ' ss:StyleID=\"DateStyle\"';\n        val = new Date(val).toISOString();\n      }\n\n      // Parasal deÄŸer kontrolÃ¼\n      else if ([\"tutar\",\"borÃ§\",\"borc\",\"alacak\",\"toplam\"].some(k => h.toLowerCase().includes(k))) {\n        const num = parseFloat(val.toString().replace(\",\", \".\"));\n        if (!isNaN(num)) {\n          cellType = \"Number\";\n          style = ' ss:StyleID=\"CurrencyStyle\"';\n          val = num;\n        }\n      }\n    }\n\n    // XML'e uygun ÅŸekilde hÃ¼cre yazÄ±mÄ±\n    if (cellType === \"DateTime\") {\n      xml += `<Cell${style}><Data ss:Type=\"DateTime\">${val}</Data></Cell>`;\n    } else {\n      xml += `<Cell${style}><Data ss:Type=\"${cellType}\">${xmlEscape(val)}</Data></Cell>`;\n    }\n  }\n\n  xml += \"</Row>\";\n}\n\nxml += \"</Table></Worksheet></Workbook>\";\n\n// --- Base64 encode\nconst base64 = Buffer.from(xml, \"utf8\").toString(\"base64\");\n\nreturn [{\n  json: {},\n  binary: {\n    data: {\n      data: base64,\n      mimeType: \"application/vnd.ms-excel\",\n      fileName: \"TakvimYaslandÄ±rma.xls\"\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -16,
        1744
      ],
      "id": "d2a73a33-edde-420b-9c57-2a1765f99000",
      "name": "Excel1"
    },
    {
      "parameters": {
        "name": "Takvim YaÅŸlandÄ±rma",
        "driveId": {
          "__rl": true,
          "value": "My Drive",
          "mode": "list",
          "cachedResultName": "My Drive",
          "cachedResultUrl": "https://drive.google.com/drive/my-drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1lokTTqz9S0jNDoibwQ4ElG5_b9pcltX2",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        144,
        1744
      ],
      "id": "c31dd766-7f1e-4b0a-b9f4-853cb122f0ef",
      "name": "excel upload1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "iN9OE5UMYJ8poAVA",
          "name": "Ãœcretli Hesap"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "DEFCA8DF2C0D-4BB3-B874-E6C2A253D6BF",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -2192,
        1696
      ],
      "id": "e7577557-117e-4f19-9bb2-b6631c065384",
      "name": "Webhook1",
      "webhookId": "96f8460d-9e01-41c6-bc1f-ce28b46a9f46"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"EXEC dbo.Aris_ABC_XYZ_Cari\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -336,
        1440
      ],
      "id": "74da94f6-0a2f-447d-838b-d372b18dd942",
      "name": "abcxyz"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.data;\n\n// XML iÃ§in escape fonksiyonu (EN KRÄ°TÄ°K DÃœZELTME)\nfunction xmlEscape(str) {\n  return String(str)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&apos;\");\n}\n\nlet items = [];\nif (Array.isArray(input)) {\n  items = input;\n} else if (typeof input === 'object') {\n  items = [input];\n}\n\nif (items.length === 0) {\n  const debugHtml = `<html><body><h3>Veri bulunamadÄ±</h3><pre>${xmlEscape(JSON.stringify(input,null,2))}</pre></body></html>`;\n  const base64 = Buffer.from(debugHtml, \"utf8\").toString(\"base64\");\n  return [{\n    json: { warning: \"No data found\" },\n    binary: { data: { data: base64, mimeType: \"text/html\", fileName: \"cari_ekstra_debug.html\" } }\n  }];\n}\n\n// --- BaÅŸlÄ±klarÄ± Ã§Ä±kar\nconst headersSet = new Set();\nitems.forEach(obj => Object.keys(obj).forEach(k => headersSet.add(k)));\nconst headers = Array.from(headersSet);\n\n// --- Her sÃ¼tun iÃ§in geniÅŸlik hesapla\nconst columnWidths = headers.map(h => {\n  let maxLen = h.length;\n  for (const item of items) {\n    const val = item[h];\n    if (val !== null && val !== undefined) {\n      maxLen = Math.max(maxLen, val.toString().length);\n    }\n  }\n  return Math.max(50, maxLen * 7);\n});\n\n// --- XML Spreadsheet baÅŸlat\nlet xml = `<?xml version=\"1.0\"?>\n<Workbook xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\n xmlns:o=\"urn:schemas-microsoft-com:office:office\"\n xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\n xmlns:ss=\"urn:schemas-microsoft-com:office:spreadsheet\">\n<Styles>\n  <Style ss:ID=\"DateStyle\">\n    <NumberFormat ss:Format=\"yyyy-mm-dd\"/>\n  </Style>\n  <Style ss:ID=\"CurrencyStyle\">\n    <NumberFormat ss:Format=\"â‚º#,##0.00\"/>\n  </Style>\n  <Style ss:ID=\"NumberStyle\">\n    <NumberFormat ss:Format=\"#,##0.00\"/>\n  </Style>\n</Styles>\n<Worksheet ss:Name=\"AbxXyz\">\n<Table>`;\n\n// --- SÃ¼tun geniÅŸliklerini ekle\nfor (const w of columnWidths) {\n  xml += `<Column ss:AutoFitWidth=\"0\" ss:Width=\"${w}\"/>`;\n}\n\n// --- BaÅŸlÄ±k satÄ±rÄ±\nxml += \"<Row>\";\nfor (const h of headers) {\n  xml += `<Cell><Data ss:Type=\"String\">${xmlEscape(h)}</Data></Cell>`;\n}\nxml += \"</Row>\";\n\n// --- Veri satÄ±rlarÄ±\nfor (const item of items) {\n  xml += \"<Row>\";\n\n  for (const h of headers) {\n    let val = item[h];\n    let cellType = \"String\";\n    let style = \"\";\n\n    if (val === null || val === undefined) val = \"\";\n\n    if (typeof val === \"number\") {\n      cellType = \"Number\";\n      style = ' ss:StyleID=\"NumberStyle\"';\n    } else if (typeof val === \"string\") {\n\n      // Tarih kontrolÃ¼\n      if (h.toLowerCase().includes(\"tarih\") && /^\\d{4}-\\d{2}-\\d{2}/.test(val)) {\n        cellType = \"DateTime\";\n        style = ' ss:StyleID=\"DateStyle\"';\n        val = new Date(val).toISOString();\n      }\n\n      // Parasal deÄŸer kontrolÃ¼\n      else if ([\"tutar\",\"borÃ§\",\"borc\",\"alacak\",\"toplam\"].some(k => h.toLowerCase().includes(k))) {\n        const num = parseFloat(val.toString().replace(\",\", \".\"));\n        if (!isNaN(num)) {\n          cellType = \"Number\";\n          style = ' ss:StyleID=\"CurrencyStyle\"';\n          val = num;\n        }\n      }\n    }\n\n    // XML'e uygun ÅŸekilde hÃ¼cre yazÄ±mÄ±\n    if (cellType === \"DateTime\") {\n      xml += `<Cell${style}><Data ss:Type=\"DateTime\">${val}</Data></Cell>`;\n    } else {\n      xml += `<Cell${style}><Data ss:Type=\"${cellType}\">${xmlEscape(val)}</Data></Cell>`;\n    }\n  }\n\n  xml += \"</Row>\";\n}\n\nxml += \"</Table></Worksheet></Workbook>\";\n\n// --- Base64 encode\nconst base64 = Buffer.from(xml, \"utf8\").toString(\"base64\");\n\nreturn [{\n  json: {},\n  binary: {\n    data: {\n      data: base64,\n      mimeType: \"application/vnd.ms-excel\",\n      fileName: \"AbcXyz.xls\"\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -176,
        1440
      ],
      "id": "dcc04b23-25df-4485-9f45-a3991b334001",
      "name": "Excel"
    },
    {
      "parameters": {
        "name": "AbcXyz Stok Raporu",
        "driveId": {
          "__rl": true,
          "value": "My Drive",
          "mode": "list",
          "cachedResultName": "My Drive",
          "cachedResultUrl": "https://drive.google.com/drive/my-drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1lokTTqz9S0jNDoibwQ4ElG5_b9pcltX2",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -16,
        1440
      ],
      "id": "96cf2cb8-0c68-4c41-a712-34205c6877c4",
      "name": "excel upload",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "iN9OE5UMYJ8poAVA",
          "name": "Ãœcretli Hesap"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"exec aris_banka_bakiye_toplamÄ±_exec\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1024,
        -128
      ],
      "id": "f5e18c57-f2bb-4b68-a787-8b0eb6ef78d0",
      "name": "Banka Bakiye"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"exec aris_MCEK_TAHSIL_exec\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1024,
        48
      ],
      "id": "e656296a-3ba0-4481-9d72-64e0994de60a",
      "name": "mcektahsil"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"aris_MSENET_PORTFOY_exec\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -832,
        48
      ],
      "id": "a5780a6f-5c78-4c22-a5d4-f3fd4d6a2885",
      "name": "msenetportfoy"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \" exec aris_MSENET_TAHSIL_exec\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -640,
        -128
      ],
      "id": "15892476-ccf6-4c54-9fa6-2a523ea5f03c",
      "name": "msenettahsil"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"SELECT SUM(cm_borct-cm_alact) as alÄ±cÄ±_cariBorc FROM TBLCASABIT WHERE CARI_TIP='A'\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -640,
        64
      ],
      "id": "f293a57c-7e74-44e7-b583-2649a94980fb",
      "name": "AlÄ±cÄ±larbakiye"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"SELECT SUM(cm_borct-cm_alact) as SatÄ±cÄ±_cariBorc FROM TBLCASABIT WHERE CARI_TIP='S'\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -448,
        64
      ],
      "id": "5e0e7d64-2d15-48f2-804e-668403d2fdf9",
      "name": "SatÄ±cÄ±caribakiye"
    },
    {
      "parameters": {
        "jsCode": "// SayÄ±yÄ± ondalÄ±ksÄ±z hale getirip binlikleri noktayla ayÄ±rÄ±r ve â‚º ekler\nfunction formatNumberWithDotsTL(value) {\n  const num = parseFloat(value);\n  if (isNaN(num)) return \"0 â‚º\";\n  return Math.round(num).toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\") + \" â‚º\";\n}\n\n// SayÄ±sal iÅŸlem iÃ§in gÃ¼venli sayÄ± dÃ¶nÃ¼ÅŸtÃ¼rme\nfunction safeNumber(value) {\n  const num = parseFloat(value);\n  return isNaN(num) ? 0 : num;\n}\n\n// Verileri al\nconst bankabakiye_raw = $('Banka Bakiye').first().json.data[0].bankaBAKIYE;\nconst mcekportfoy_raw = $('mcekportfoy').first().json.data[0].MCEKT;\nconst mcektahsil_raw = $('msenettahsil').first().json.data[0].MSENET_TAHSIL;\nconst msenetportfoy_raw = $('msenetportfoy').first().json.data[0].MSENET_PORTFOY;\nconst msenettahsil_raw = $('msenettahsil').first().json.data[0].MSENET_TAHSIL;\nconst alÄ±cÄ±larbakiye_raw = $('AlÄ±cÄ±larbakiye').first().json.data[0]['alÄ±cÄ±_cariBorc'];\nconst satÄ±cÄ±bakiye_raw = $input.first().json.data[0]['SatÄ±cÄ±_cariBorc'];\nconst kasakalanbakiye_raw=$('Kasa Kalan').first().json.data[0].Kasa_kalan;\nconst kredikartÄ±bakiye_raw = $('KrediKartÄ±BAKIYE').first().json.data[0]['KrediKartÄ±BAKIYE'];\nconst mcek_bekleyen = $('mcek_bekleyen').first().json.data[0].MCEK_BEKLEYEN_BAKIYE;\nconst KDVdahilgenelToplam = $input.first().json.data[0].KDV_DAHIL_GENELTOPLAM;\n\n// Toplam hesaplama\nconst toplam = \n  safeNumber(bankabakiye_raw) +\n  safeNumber(mcekportfoy_raw) +\n  safeNumber(mcektahsil_raw) +\n  safeNumber(msenetportfoy_raw) +\n  safeNumber(msenettahsil_raw) +\n  safeNumber(alÄ±cÄ±larbakiye_raw) +\n  safeNumber(satÄ±cÄ±bakiye_raw) +\n  safeNumber(kasakalanbakiye_raw) +\n  safeNumber(kredikartÄ±bakiye_raw) +\n  safeNumber(mcek_bekleyen) +\n  safeNumber(KDVdahilgenelToplam) ;\n\n// Genel durum belirleme\nlet genelDurum = \"\";\nif (toplam > 0) genelDurum = \"ğŸ’° Ä°ÅŸletme genel olarak artÄ±da.\";\nelse if (toplam < 0) genelDurum = \"ğŸ“‰ Ä°ÅŸletme genel olarak ekside.\";\nelse genelDurum = \"âš–ï¸ Ä°ÅŸletme dengede.\";\n\n// Ana rapor nesnesi (TL ile)\nconst faaliyetRaporu = {\n  \"Banka Bakiyesi\": formatNumberWithDotsTL(bankabakiye_raw),\n  \"MÃ¼ÅŸteri Ã‡ek PortfÃ¶yÃ¼\": formatNumberWithDotsTL(mcekportfoy_raw),\n  \"MÃ¼ÅŸteri Ã‡ek Tahsilat\": formatNumberWithDotsTL(mcektahsil_raw),\n  \"MÃ¼ÅŸteri Senet PortfÃ¶yÃ¼\": formatNumberWithDotsTL(msenetportfoy_raw),\n  \"MÃ¼ÅŸteri Senet Tahsilat\": formatNumberWithDotsTL(msenettahsil_raw),\n  \"AlÄ±cÄ±lar Bakiyesi\": formatNumberWithDotsTL(alÄ±cÄ±larbakiye_raw),\n  \"SatÄ±cÄ±lar Bakiyesi\": formatNumberWithDotsTL(satÄ±cÄ±bakiye_raw),\n  \"Kasa kalan Bakiyesi\" : formatNumberWithDotsTL(kasakalanbakiye_raw),\n  \"Kredi KartÄ± Bakiyesi\":formatNumberWithDotsTL(kredikartÄ±bakiye_raw),\n  \"MÃ¼ÅŸteri Ã‡eki Bekleyen\":formatNumberWithDotsTL(mcek_bekleyen),\n  \"Kdv Genel Toplam\":formatNumberWithDotsTL(KDVdahilgenelToplam),\n  \"Toplam Genel Durum\": formatNumberWithDotsTL(toplam),\n  \"Durum Yorumu\": genelDurum\n};\n\n// JSON olarak dÃ¶ndÃ¼r\nreturn [\n  {\n    json: {\n      \"Faaliyet Raporu Analiz Sonucu\": faaliyetRaporu\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -80,
        -128
      ],
      "id": "37cd0da5-f8fe-4d36-9b57-dc13178c616a",
      "name": "Ä°Ã§erik DÃ¼zenleme"
    },
    {
      "parameters": {
        "jsCode": "const rapor =$input.first().json['Faaliyet Raporu Analiz Sonucu']\n\n// MesajÄ± oluÅŸtur\nlet mesaj = \"*ğŸ“Š Faaliyet Raporu Analiz Sonucu*\\n\\n\";\nfor (let key in rapor) {\n  mesaj += `*${key}:* ${rapor[key]}\\n`;\n}\n\nreturn [\n  {\n    json: {\n      \"whatsappMessage\": mesaj\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -64,
        16
      ],
      "id": "e5c82bf4-42f6-4f1e-a8f6-8f46b745a0b1",
      "name": "Whatsapp Message"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Webhook1').item.json.body.instance }}",
        "remoteJid": "={{ $('Webhook1').item.json.body.data.key.remoteJid }}",
        "messageText": "={{ $json.whatsappMessage }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "typeVersion": 1,
      "position": [
        -64,
        160
      ],
      "id": "7e3fcd19-badd-45a4-832d-5d8e8f81a3a6",
      "name": "Faliyet Raporu SonuÃ§ GÃ¶nderme",
      "credentials": {
        "evolutionApi": {
          "id": "boMU56w93xgnxgsV",
          "name": "emre"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \" exec aris_kasakalan_exec\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -448,
        -128
      ],
      "id": "635184b9-fede-43cc-b5a2-625c4289a5b2",
      "name": "Kasa Kalan"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"select ISNULL(SUM(BAKIYE),0) AS KrediKartÄ±BAKIYE from mtr_BANKABAKIYELER WHERE HESAPSEKLI='Kredi Karti'\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -272,
        -128
      ],
      "id": "00a52809-5974-412d-9647-e0726154d957",
      "name": "KrediKartÄ±BAKIYE"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"exec aris_BCEK_BEKLEYEN_BAKIYE_exec\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -272,
        16
      ],
      "id": "e551427f-9d51-4006-a357-8392207f7392",
      "name": "mcek_bekleyen"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \" exec aris_KDV_DAHIL_GENELTOPLAM_exec\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -272,
        160
      ],
      "id": "578890d3-d49e-46cb-95ad-3d01d409803a",
      "name": "KDV dahil genel toplam"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"exec aris_plasiyersatÄ±s_RAPORU_exec @Ay ={{ $('Category').item.json.ay }}\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -208,
        448
      ],
      "id": "410cf912-0134-4fce-b113-1f274786d94c",
      "name": "PlasiyerAylÄ±kSatÄ±sRaporu"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.data;\n\nlet items = [];\nif (Array.isArray(input)) {\n  items = input;\n} else if (typeof input === 'object') {\n  items = [input];\n}\n\nif (items.length === 0) {\n  const debugHtml = `<html><body><h3>Veri bulunamadÄ±</h3><pre>${JSON.stringify(input,null,2)}</pre></body></html>`;\n  const base64 = Buffer.from(debugHtml, \"utf8\").toString(\"base64\");\n  return [{\n    json: { warning: \"No data found\" },\n    binary: { data: { data: base64, mimeType: \"text/html\", fileName: \"cari_ekstra_debug.html\" } }\n  }];\n}\n\n// --- BaÅŸlÄ±klarÄ± Ã§Ä±kar\nconst headersSet = new Set();\nitems.forEach(obj => Object.keys(obj).forEach(k => headersSet.add(k)));\nconst headers = Array.from(headersSet);\n\n// --- Her sÃ¼tun iÃ§in geniÅŸlik hesapla\nconst columnWidths = headers.map(h => {\n  let maxLen = h.length;\n  for (const item of items) {\n    const val = item[h];\n    if (val !== null && val !== undefined) {\n      maxLen = Math.max(maxLen, val.toString().length);\n    }\n  }\n  return Math.max(50, maxLen * 7);\n});\n\n// --- XML Spreadsheet baÅŸlat\nlet xml = `<?xml version=\"1.0\"?>\n<Workbook xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\n xmlns:o=\"urn:schemas-microsoft-com:office:office\"\n xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\n xmlns:ss=\"urn:schemas-microsoft-com:office:spreadsheet\">\n<Styles>\n  <Style ss:ID=\"DateStyle\">\n    <NumberFormat ss:Format=\"yyyy-mm-dd\"/>\n  </Style>\n  <Style ss:ID=\"CurrencyStyle\">\n    <NumberFormat ss:Format=\"â‚º#,##0.00\"/>\n  </Style>\n  <Style ss:ID=\"NumberStyle\">\n    <NumberFormat ss:Format=\"#,##0.00\"/>\n  </Style>\n</Styles>\n<Worksheet ss:Name=\"CariEkstra\">\n<Table>`;\n\n// --- SÃ¼tun geniÅŸliklerini ekle\nfor (const w of columnWidths) {\n  xml += `<Column ss:AutoFitWidth=\"0\" ss:Width=\"${w}\"/>`;\n}\n\n// --- BaÅŸlÄ±k satÄ±rÄ±\nxml += \"<Row>\";\nfor (const h of headers) {\n  xml += `<Cell><Data ss:Type=\"String\">${h}</Data></Cell>`;\n}\nxml += \"</Row>\";\n\n// --- Veri satÄ±rlarÄ±\nfor (const item of items) {\n  xml += \"<Row>\";\n  for (const h of headers) {\n    let val = item[h];\n    let cellType = \"String\";\n    let style = \"\";\n\n    if (val === null || val === undefined) val = \"\";\n\n    if (typeof val === \"number\") {\n      cellType = \"Number\";\n      style = ' ss:StyleID=\"NumberStyle\"';\n    } else if (typeof val === \"string\") {\n      // Tarih kontrolÃ¼\n      if (h.toLowerCase().includes(\"tarih\") && /^\\d{4}-\\d{2}-\\d{2}/.test(val)) {\n        cellType = \"DateTime\";\n        style = ' ss:StyleID=\"DateStyle\"';\n        val = new Date(val).toISOString();\n      }\n      // Parasal deÄŸer kontrolÃ¼\n      else if ([\"tutar\",\"borÃ§\",\"borc\",\"alacak\",\"toplam\"].some(k => h.toLowerCase().includes(k))) {\n        const num = parseFloat(val.toString().replace(\",\", \".\"));\n        if (!isNaN(num)) {\n          cellType = \"Number\";\n          style = ' ss:StyleID=\"CurrencyStyle\"';\n          val = num;\n        }\n      }\n    }\n\n    xml += `<Cell${style}><Data ss:Type=\"${cellType}\">${val}</Data></Cell>`;\n  }\n  xml += \"</Row>\";\n}\n\nxml += \"</Table></Worksheet></Workbook>\";\n\n// --- Base64 encode\nconst base64 = Buffer.from(xml, \"utf8\").toString(\"base64\");\n\nreturn [{\n  json: {},\n  binary: {\n    data: {\n      data: base64,\n      mimeType: \"application/vnd.ms-excel\",\n      fileName: \"AbcXyz.xls\"\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -16,
        448
      ],
      "id": "22a9b69e-e013-4950-9efa-49dc141496c1",
      "name": "Excel2"
    },
    {
      "parameters": {
        "name": "Plasiyer AylÄ±k SatÄ±ÅŸ Raporu",
        "driveId": {
          "__rl": true,
          "value": "My Drive",
          "mode": "list",
          "cachedResultName": "My Drive",
          "cachedResultUrl": "https://drive.google.com/drive/my-drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1lokTTqz9S0jNDoibwQ4ElG5_b9pcltX2",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        176,
        448
      ],
      "id": "4a0edcbf-bbb1-4ce7-9478-6aaa58286f03",
      "name": "excel upload2",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "iN9OE5UMYJ8poAVA",
          "name": "Ãœcretli Hesap"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Webhook1').item.json.body.instance }}",
        "remoteJid": "={{ $('Webhook1').item.json.body.data.key.remoteJid }}",
        "messageText": "=Plasiyer SatÄ±ÅŸ Raporunuz hazÄ±r. AÅŸaÄŸÄ±daki baÄŸlantÄ±dan ulaÅŸabilirsiniz.\n\n{{ $json.webViewLink }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "typeVersion": 1,
      "position": [
        352,
        448
      ],
      "id": "4f6dae27-46fe-4c0a-b81c-79f12a616bcc",
      "name": "Send text",
      "credentials": {
        "evolutionApi": {
          "id": "boMU56w93xgnxgsV",
          "name": "emre"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"exec aris_mcek_portfÃ¶y_exec\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -864,
        -128
      ],
      "id": "eb936123-acc8-464c-a3f4-2ca673da35ad",
      "name": "mcekportfoy"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.category }}",
                    "rightValue": "null",
                    "operator": {
                      "type": "string",
                      "operation": "empty",
                      "singleValue": true
                    },
                    "id": "daaf87f9-9c5f-4ae3-808f-d97bebef654b"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "true"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e81b7330-e69c-4d6b-8b0f-f0af6e58a815",
                    "leftValue": "={{ $json.message }}",
                    "rightValue": "null",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "false"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -1168,
        1712
      ],
      "id": "e8d4e9e0-d16f-4907-85b8-3f36585e310f",
      "name": "Switch1"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Webhook1').item.json.body.instance }}",
        "remoteJid": "={{ $('Webhook1').item.json.body.data.key.remoteJid }}",
        "messageText": "={{ $json.message }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "typeVersion": 1,
      "position": [
        -912,
        1648
      ],
      "id": "a3254cf3-d43a-4531-bc20-e8fb2df475c8",
      "name": "Merhaba MesajÄ±",
      "credentials": {
        "evolutionApi": {
          "id": "boMU56w93xgnxgsV",
          "name": "emre"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Webhook1').item.json.body.instance }}",
        "remoteJid": "={{ $('Webhook1').item.json.body.data.key.remoteJid }}",
        "messageText": "={{ $('Category').item.json.category }} Raporunuz hazÄ±r. AÅŸaÄŸÄ±daki baÄŸlantÄ±dan ulaÅŸabilirsiniz.\n\n{{ $json.webViewLink }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "typeVersion": 1,
      "position": [
        144,
        1440
      ],
      "id": "2f9e0940-1318-4b9d-9d78-32fc664cdaad",
      "name": "ABC",
      "credentials": {
        "evolutionApi": {
          "id": "boMU56w93xgnxgsV",
          "name": "emre"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Webhook1').item.json.body.instance }}",
        "remoteJid": "={{ $('Webhook1').item.json.body.data.key.remoteJid }}",
        "messageText": "={{ $('Category').item.json.category }} Raporunuz hazÄ±r. AÅŸaÄŸÄ±daki baÄŸlantÄ±dan ulaÅŸabilirsiniz.\n\n{{ $json.webViewLink }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "typeVersion": 1,
      "position": [
        288,
        1744
      ],
      "id": "a4fd7f00-78e1-4a2c-ab1b-0f5f463a71ef",
      "name": "YAÅLANDIRMA",
      "credentials": {
        "evolutionApi": {
          "id": "boMU56w93xgnxgsV",
          "name": "emre"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Webhook1').item.json.body.instance }}",
        "remoteJid": "={{ $('Webhook1').item.json.body.data.key.remoteJid }}",
        "messageText": "={{ $('Code in JavaScript').item.json.category }}  Raporunuz HazÄ±r. AÅŸaÄŸÄ±daki baÄŸlantÄ±dan ulaÅŸabilirsiniz.\n\n{{ $json.webViewLink }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "typeVersion": 1,
      "position": [
        -400,
        2752
      ],
      "id": "642bc6a7-20d2-4bb1-97de-1e1653025e4e",
      "name": "Send text1",
      "credentials": {
        "evolutionApi": {
          "id": "boMU56w93xgnxgsV",
          "name": "emre"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.data;\nlet items = Array.isArray(input) ? input : [input];\n\n// --- XML KaÃ§Ä±ÅŸ Fonksiyonu (EN Ã–NEMLÄ° DÃœZELTME)\nfunction xmlEscape(str) {\n  return String(str)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&apos;\");\n}\n\n// --- BaÅŸlÄ±klar\nconst headers = [\n  \"CARI_KOD\",\n  \"ISIM\",\n  \"TARIH\",\n  \"VADE_TARIHI\",\n  \"TUTAR (Gelir)\",\n  \"TUTAR (Gider)\",\n  \"MODUL\"\n];\n\n// --- SÃ¼tun geniÅŸlikleri\nconst columnWidths = headers.map(h => {\n  let maxLen = h.length;\n  for (const item of items) {\n    let val = \"\";\n    switch(h) {\n      case \"TUTAR (Gelir)\":\n        val = item.DURUM === \"Gelir\" ? item.TUTAR : \"\";\n        break;\n      case \"TUTAR (Gider)\":\n        val = item.DURUM === \"Gider\" ? item.TUTAR : \"\";\n        break;\n      case \"TARIH\":\n        val = item.TARIH ? new Date(item.TARIH).toLocaleDateString(\"tr-TR\") : \"\";\n        break;\n      case \"VADE_TARIHI\":\n        val = item.VADE_TARIHI ? new Date(item.VADE_TARIHI).toLocaleDateString(\"tr-TR\") : \"\";\n        break;\n      default:\n        val = item[h] ?? \"\";\n    }\n    maxLen = Math.max(maxLen, val.toString().length);\n  }\n  return Math.max(50, maxLen * 7);\n});\n\n// --- XML BaÅŸlat\nlet xml = `<?xml version=\"1.0\"?>\n<Workbook xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\n xmlns:o=\"urn:schemas-microsoft-com:office:office\"\n xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\n xmlns:ss=\"urn:schemas-microsoft-com:office:spreadsheet\">\n<Styles>\n  <Style ss:ID=\"CurrencyStyle\">\n    <NumberFormat ss:Format=\"â‚º#,##0.00\"/>\n  </Style>\n  <Style ss:ID=\"DateStyle\">\n    <NumberFormat ss:Format=\"yyyy-mm-dd\"/>\n  </Style>\n  <Style ss:ID=\"HeaderStyle\">\n    <Font ss:Bold=\"1\"/>\n  </Style>\n  <Style ss:ID=\"TotalHeaderStyle\">\n    <Font ss:Bold=\"1\"/>\n    <Interior ss:Color=\"#FFFF00\" ss:Pattern=\"Solid\"/>\n  </Style>\n</Styles>\n<Worksheet ss:Name=\"tahsilat_odemeler\">\n<Table>`;\n\n// --- SÃ¼tun geniÅŸlikleri\nfor (const w of columnWidths) {\n  xml += `<Column ss:AutoFitWidth=\"0\" ss:Width=\"${w}\"/>`;\n}\n\n// --- BaÅŸlÄ±k satÄ±rÄ±\nxml += \"<Row>\";\nfor (const h of headers) {\n  xml += `<Cell ss:StyleID=\"HeaderStyle\"><Data ss:Type=\"String\">${xmlEscape(h)}</Data></Cell>`;\n}\nxml += \"</Row>\";\n\n// --- Toplamlar\nlet toplamGelir = 0;\nlet toplamGider = 0;\n\n// --- Veri satÄ±rlarÄ±\nfor (const item of items) {\n  xml += \"<Row>\";\n\n  xml += `<Cell><Data ss:Type=\"String\">${xmlEscape(item.CARI_KOD ?? \"\")}</Data></Cell>`;\n  xml += `<Cell><Data ss:Type=\"String\">${xmlEscape(item.ISIM ?? \"\")}</Data></Cell>`;\n\n  const tarihISO = item.TARIH ? new Date(item.TARIH).toISOString() : \"\";\n  xml += `<Cell ss:StyleID=\"DateStyle\"><Data ss:Type=\"DateTime\">${tarihISO}</Data></Cell>`;\n\n  const vadeISO = item.VADE_TARIHI ? new Date(item.VADE_TARIHI).toISOString() : \"\";\n  xml += `<Cell ss:StyleID=\"DateStyle\"><Data ss:Type=\"DateTime\">${vadeISO}</Data></Cell>`;\n\n  const tutarGelir = item.DURUM === \"Gelir\" ? item.TUTAR ?? 0 : \"\";\n  const tutarGider = item.DURUM === \"Gider\" ? item.TUTAR ?? 0 : \"\";\n\n  if (tutarGelir !== \"\") toplamGelir += parseFloat(tutarGelir);\n  if (tutarGider !== \"\") toplamGider += parseFloat(tutarGider);\n\n  xml += `<Cell ss:StyleID=\"CurrencyStyle\"><Data ss:Type=\"Number\">${tutarGelir}</Data></Cell>`;\n  xml += `<Cell ss:StyleID=\"CurrencyStyle\"><Data ss:Type=\"Number\">${tutarGider}</Data></Cell>`;\n\n  xml += `<Cell><Data ss:Type=\"String\">${xmlEscape(item.MODUL ?? \"\")}</Data></Cell>`;\n\n  xml += \"</Row>\";\n}\n\n// --- TOPLAM BAÅLIK SATIRI\nxml += \"<Row>\";\nxml += `<Cell/><Cell/><Cell/><Cell/>`;\nxml += `<Cell ss:StyleID=\"TotalHeaderStyle\"><Data ss:Type=\"String\">TOPLAM</Data></Cell>`;\nxml += `<Cell ss:StyleID=\"TotalHeaderStyle\"><Data ss:Type=\"String\">TOPLAM</Data></Cell>`;\nxml += `<Cell/>`;\nxml += \"</Row>\";\n\n// --- TOPLAM DEÄER SATIRI\nxml += \"<Row>\";\nxml += `<Cell/><Cell/><Cell/><Cell/>`;\nxml += `<Cell ss:StyleID=\"CurrencyStyle\"><Data ss:Type=\"Number\">${toplamGelir}</Data></Cell>`;\nxml += `<Cell ss:StyleID=\"CurrencyStyle\"><Data ss:Type=\"Number\">${toplamGider}</Data></Cell>`;\nxml += `<Cell/>`;\nxml += \"</Row>\";\n\nxml += \"</Table></Worksheet></Workbook>\";\n\n// --- Base64 encode\nconst base64 = Buffer.from(xml, \"utf8\").toString(\"base64\");\n\nreturn [{\n  json: {},\n  binary: {\n    data: {\n      data: base64,\n      mimeType: \"application/vnd.ms-excel\",\n      fileName: \"tahsilat_odemeler.xls\"\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -784,
        2752
      ],
      "id": "57d00bed-9724-428b-917b-d408acaf2581",
      "name": "Excel3"
    },
    {
      "parameters": {
        "name": "GÃ¼nlÃ¼k Tahsilat/Ã¶deme",
        "driveId": {
          "__rl": true,
          "value": "My Drive",
          "mode": "list",
          "cachedResultName": "My Drive",
          "cachedResultUrl": "https://drive.google.com/drive/my-drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1lokTTqz9S0jNDoibwQ4ElG5_b9pcltX2",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -576,
        2752
      ],
      "id": "2ee00189-08dd-4e01-bf6d-f613fb2b016d",
      "name": "excel upload3",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "iN9OE5UMYJ8poAVA",
          "name": "Ãœcretli Hesap"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"exec sp_Aris_VadeBugun_TahsilatOdeme\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -976,
        2752
      ],
      "id": "209124ab-3266-428e-a3bc-58807377b3f9",
      "name": "Ã¶deme/tahsilat"
    },
    {
      "parameters": {
        "content": "Faliyet",
        "height": 480,
        "width": 1216
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1072,
        -176
      ],
      "id": "60433318-513e-4d6f-8d5f-36f827c1da1a",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"exec Aris_Borc_Alacak_Plasiyer_Carikart_exec\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1024,
        2992
      ],
      "id": "cd91742d-2e3f-414e-9b95-07fe56fd6981",
      "name": "Cari Kartdaki tanÄ±mlÄ± plasiyere gÃ¶re"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"exec Aris_Borc_Alacak_plasiyer_hareket_exec\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1024,
        3200
      ],
      "id": "7afc4379-944c-40d7-9a84-2b90052e4d89",
      "name": "Cari Hareketlerindeki plasiyere gÃ¶re"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"EXEC Aris_Borc_Alacak_exec\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1024,
        3408
      ],
      "id": "4bf611ad-bcef-446f-910c-22bc12c3dfd0",
      "name": "Cari BorÃ§ Alacak"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.data;\n\n// XML iÃ§in escape fonksiyonu (EN KRÄ°TÄ°K DÃœZELTME)\nfunction xmlEscape(str) {\n  return String(str)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&apos;\");\n}\n\nlet items = [];\nif (Array.isArray(input)) {\n  items = input;\n} else if (typeof input === 'object') {\n  items = [input];\n}\n\nif (items.length === 0) {\n  const debugHtml = `<html><body><h3>Veri bulunamadÄ±</h3><pre>${xmlEscape(JSON.stringify(input,null,2))}</pre></body></html>`;\n  const base64 = Buffer.from(debugHtml, \"utf8\").toString(\"base64\");\n  return [{\n    json: { warning: \"No data found\" },\n    binary: { data: { data: base64, mimeType: \"text/html\", fileName: \"cari_ekstra_debug.html\" } }\n  }];\n}\n\n// --- BaÅŸlÄ±klarÄ± Ã§Ä±kar\nconst headersSet = new Set();\nitems.forEach(obj => Object.keys(obj).forEach(k => headersSet.add(k)));\nconst headers = Array.from(headersSet);\n\n// --- Her sÃ¼tun iÃ§in geniÅŸlik hesapla\nconst columnWidths = headers.map(h => {\n  let maxLen = h.length;\n  for (const item of items) {\n    const val = item[h];\n    if (val !== null && val !== undefined) {\n      maxLen = Math.max(maxLen, val.toString().length);\n    }\n  }\n  return Math.max(50, maxLen * 7);\n});\n\n// --- XML Spreadsheet baÅŸlat\nlet xml = `<?xml version=\"1.0\"?>\n<Workbook xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\n xmlns:o=\"urn:schemas-microsoft-com:office:office\"\n xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\n xmlns:ss=\"urn:schemas-microsoft-com:office:spreadsheet\">\n<Styles>\n  <Style ss:ID=\"DateStyle\">\n    <NumberFormat ss:Format=\"yyyy-mm-dd\"/>\n  </Style>\n  <Style ss:ID=\"CurrencyStyle\">\n    <NumberFormat ss:Format=\"â‚º#,##0.00\"/>\n  </Style>\n  <Style ss:ID=\"NumberStyle\">\n    <NumberFormat ss:Format=\"#,##0.00\"/>\n  </Style>\n</Styles>\n<Worksheet ss:Name=\"Cari Kartdaki tanÄ±mlÄ± plasiyere gÃ¶re\">\n<Table>`;\n\n// --- SÃ¼tun geniÅŸliklerini ekle\nfor (const w of columnWidths) {\n  xml += `<Column ss:AutoFitWidth=\"0\" ss:Width=\"${w}\"/>`;\n}\n\n// --- BaÅŸlÄ±k satÄ±rÄ±\nxml += \"<Row>\";\nfor (const h of headers) {\n  xml += `<Cell><Data ss:Type=\"String\">${xmlEscape(h)}</Data></Cell>`;\n}\nxml += \"</Row>\";\n\n// --- Veri satÄ±rlarÄ±\nfor (const item of items) {\n  xml += \"<Row>\";\n\n  for (const h of headers) {\n    let val = item[h];\n    let cellType = \"String\";\n    let style = \"\";\n\n    if (val === null || val === undefined) val = \"\";\n\n    if (typeof val === \"number\") {\n      cellType = \"Number\";\n      style = ' ss:StyleID=\"NumberStyle\"';\n    } else if (typeof val === \"string\") {\n\n      // Tarih kontrolÃ¼\n      if (h.toLowerCase().includes(\"tarih\") && /^\\d{4}-\\d{2}-\\d{2}/.test(val)) {\n        cellType = \"DateTime\";\n        style = ' ss:StyleID=\"DateStyle\"';\n        val = new Date(val).toISOString();\n      }\n\n      // Parasal deÄŸer kontrolÃ¼\n      else if ([\"tutar\",\"borÃ§\",\"borc\",\"alacak\",\"toplam\"].some(k => h.toLowerCase().includes(k))) {\n        const num = parseFloat(val.toString().replace(\",\", \".\"));\n        if (!isNaN(num)) {\n          cellType = \"Number\";\n          style = ' ss:StyleID=\"CurrencyStyle\"';\n          val = num;\n        }\n      }\n    }\n\n    // XML'e uygun ÅŸekilde hÃ¼cre yazÄ±mÄ±\n    if (cellType === \"DateTime\") {\n      xml += `<Cell${style}><Data ss:Type=\"DateTime\">${val}</Data></Cell>`;\n    } else {\n      xml += `<Cell${style}><Data ss:Type=\"${cellType}\">${xmlEscape(val)}</Data></Cell>`;\n    }\n  }\n\n  xml += \"</Row>\";\n}\n\nxml += \"</Table></Worksheet></Workbook>\";\n\n// --- Base64 encode\nconst base64 = Buffer.from(xml, \"utf8\").toString(\"base64\");\n\nreturn [{\n  json: {},\n  binary: {\n    data: {\n      data: base64,\n      mimeType: \"application/vnd.ms-excel\",\n      fileName: \"Cari Kartdaki tanÄ±mlÄ± plasiyere gÃ¶re.xls\"\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -784,
        2992
      ],
      "id": "1dd73995-6ec3-481d-be93-a71416502a7e",
      "name": "Excel4"
    },
    {
      "parameters": {
        "name": "=Cari Kartdaki tanÄ±mlÄ± plasiyere gÃ¶re",
        "driveId": {
          "__rl": true,
          "value": "My Drive",
          "mode": "list",
          "cachedResultName": "My Drive",
          "cachedResultUrl": "https://drive.google.com/drive/my-drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1lokTTqz9S0jNDoibwQ4ElG5_b9pcltX2",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -592,
        2992
      ],
      "id": "59c2b89f-669b-49d3-860a-efbd666c6286",
      "name": "excel upload4",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "iN9OE5UMYJ8poAVA",
          "name": "Ãœcretli Hesap"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Webhook1').item.json.body.instance }}",
        "remoteJid": "={{ $('Webhook1').item.json.body.data.key.remoteJid }}",
        "messageText": "={{ $('Category').item.json.category }} Raporunuz hazÄ±r. AÅŸaÄŸÄ±daki baÄŸlantÄ±dan ulaÅŸabilirsiniz.\n\n{{ $json.webViewLink }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "typeVersion": 1,
      "position": [
        -368,
        2992
      ],
      "id": "141e40a3-61eb-4a04-bed8-220e71a3c013",
      "name": "Send text2",
      "credentials": {
        "evolutionApi": {
          "id": "boMU56w93xgnxgsV",
          "name": "emre"
        }
      }
    },
    {
      "parameters": {
        "name": "Cari Hareketlerindeki plasiyere gÃ¶re",
        "driveId": {
          "__rl": true,
          "value": "My Drive",
          "mode": "list",
          "cachedResultName": "My Drive",
          "cachedResultUrl": "https://drive.google.com/drive/my-drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1lokTTqz9S0jNDoibwQ4ElG5_b9pcltX2",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -560,
        3200
      ],
      "id": "076eeb57-070d-4294-bf86-edb8a6244c54",
      "name": "excel upload5",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "iN9OE5UMYJ8poAVA",
          "name": "Ãœcretli Hesap"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Webhook1').item.json.body.instance }}",
        "remoteJid": "={{ $('Webhook1').item.json.body.data.key.remoteJid }}",
        "messageText": "={{ $('Category').item.json.category }}  Raporunuz hazÄ±r. AÅŸaÄŸÄ±daki baÄŸlantÄ±dan ulaÅŸabilirsiniz.\n\n{{ $json.webViewLink }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "typeVersion": 1,
      "position": [
        -368,
        3200
      ],
      "id": "1c705cd6-373f-4194-8ec7-0e307b638f75",
      "name": "Send text3",
      "credentials": {
        "evolutionApi": {
          "id": "boMU56w93xgnxgsV",
          "name": "emre"
        }
      }
    },
    {
      "parameters": {
        "name": "Cari BorÃ§ Alacak",
        "driveId": {
          "__rl": true,
          "value": "My Drive",
          "mode": "list",
          "cachedResultName": "My Drive",
          "cachedResultUrl": "https://drive.google.com/drive/my-drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1lokTTqz9S0jNDoibwQ4ElG5_b9pcltX2",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -624,
        3408
      ],
      "id": "98929e81-ba11-4f9d-9902-10d9c95bae5d",
      "name": "excel upload6",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "iN9OE5UMYJ8poAVA",
          "name": "Ãœcretli Hesap"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.data;\n\n// XML iÃ§in escape fonksiyonu (EN KRÄ°TÄ°K DÃœZELTME)\nfunction xmlEscape(str) {\n  return String(str)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&apos;\");\n}\n\nlet items = [];\nif (Array.isArray(input)) {\n  items = input;\n} else if (typeof input === 'object') {\n  items = [input];\n}\n\nif (items.length === 0) {\n  const debugHtml = `<html><body><h3>Veri bulunamadÄ±</h3><pre>${xmlEscape(JSON.stringify(input,null,2))}</pre></body></html>`;\n  const base64 = Buffer.from(debugHtml, \"utf8\").toString(\"base64\");\n  return [{\n    json: { warning: \"No data found\" },\n    binary: { data: { data: base64, mimeType: \"text/html\", fileName: \"cari_ekstra_debug.html\" } }\n  }];\n}\n\n// --- BaÅŸlÄ±klarÄ± Ã§Ä±kar\nconst headersSet = new Set();\nitems.forEach(obj => Object.keys(obj).forEach(k => headersSet.add(k)));\nconst headers = Array.from(headersSet);\n\n// --- Her sÃ¼tun iÃ§in geniÅŸlik hesapla\nconst columnWidths = headers.map(h => {\n  let maxLen = h.length;\n  for (const item of items) {\n    const val = item[h];\n    if (val !== null && val !== undefined) {\n      maxLen = Math.max(maxLen, val.toString().length);\n    }\n  }\n  return Math.max(50, maxLen * 7);\n});\n\n// --- XML Spreadsheet baÅŸlat\nlet xml = `<?xml version=\"1.0\"?>\n<Workbook xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\n xmlns:o=\"urn:schemas-microsoft-com:office:office\"\n xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\n xmlns:ss=\"urn:schemas-microsoft-com:office:spreadsheet\">\n<Styles>\n  <Style ss:ID=\"DateStyle\">\n    <NumberFormat ss:Format=\"yyyy-mm-dd\"/>\n  </Style>\n  <Style ss:ID=\"CurrencyStyle\">\n    <NumberFormat ss:Format=\"â‚º#,##0.00\"/>\n  </Style>\n  <Style ss:ID=\"NumberStyle\">\n    <NumberFormat ss:Format=\"#,##0.00\"/>\n  </Style>\n</Styles>\n<Worksheet ss:Name=\"CariHareketlerindekiplasiyeregÃ¶re\">\n<Table>`;\n\n// --- SÃ¼tun geniÅŸliklerini ekle\nfor (const w of columnWidths) {\n  xml += `<Column ss:AutoFitWidth=\"0\" ss:Width=\"${w}\"/>`;\n}\n\n// --- BaÅŸlÄ±k satÄ±rÄ±\nxml += \"<Row>\";\nfor (const h of headers) {\n  xml += `<Cell><Data ss:Type=\"String\">${xmlEscape(h)}</Data></Cell>`;\n}\nxml += \"</Row>\";\n\n// --- Veri satÄ±rlarÄ±\nfor (const item of items) {\n  xml += \"<Row>\";\n\n  for (const h of headers) {\n    let val = item[h];\n    let cellType = \"String\";\n    let style = \"\";\n\n    if (val === null || val === undefined) val = \"\";\n\n    if (typeof val === \"number\") {\n      cellType = \"Number\";\n      style = ' ss:StyleID=\"NumberStyle\"';\n    } else if (typeof val === \"string\") {\n\n      // Tarih kontrolÃ¼\n      if (h.toLowerCase().includes(\"tarih\") && /^\\d{4}-\\d{2}-\\d{2}/.test(val)) {\n        cellType = \"DateTime\";\n        style = ' ss:StyleID=\"DateStyle\"';\n        val = new Date(val).toISOString();\n      }\n\n      // Parasal deÄŸer kontrolÃ¼\n      else if ([\"tutar\",\"borÃ§\",\"borc\",\"alacak\",\"toplam\"].some(k => h.toLowerCase().includes(k))) {\n        const num = parseFloat(val.toString().replace(\",\", \".\"));\n        if (!isNaN(num)) {\n          cellType = \"Number\";\n          style = ' ss:StyleID=\"CurrencyStyle\"';\n          val = num;\n        }\n      }\n    }\n\n    // XML'e uygun ÅŸekilde hÃ¼cre yazÄ±mÄ±\n    if (cellType === \"DateTime\") {\n      xml += `<Cell${style}><Data ss:Type=\"DateTime\">${val}</Data></Cell>`;\n    } else {\n      xml += `<Cell${style}><Data ss:Type=\"${cellType}\">${xmlEscape(val)}</Data></Cell>`;\n    }\n  }\n\n  xml += \"</Row>\";\n}\n\nxml += \"</Table></Worksheet></Workbook>\";\n\n// --- Base64 encode\nconst base64 = Buffer.from(xml, \"utf8\").toString(\"base64\");\n\nreturn [{\n  json: {},\n  binary: {\n    data: {\n      data: base64,\n      mimeType: \"application/vnd.ms-excel\",\n      fileName: \"CariHareketlerindekiplasiyeregÃ¶re.xls\"\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -784,
        3200
      ],
      "id": "adffbab7-8924-4704-afc4-93879d9f7ee8",
      "name": "Excel7"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.data;\n\n// XML iÃ§in escape fonksiyonu (EN KRÄ°TÄ°K DÃœZELTME)\nfunction xmlEscape(str) {\n  return String(str)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&apos;\");\n}\n\nlet items = [];\nif (Array.isArray(input)) {\n  items = input;\n} else if (typeof input === 'object') {\n  items = [input];\n}\n\nif (items.length === 0) {\n  const debugHtml = `<html><body><h3>Veri bulunamadÄ±</h3><pre>${xmlEscape(JSON.stringify(input,null,2))}</pre></body></html>`;\n  const base64 = Buffer.from(debugHtml, \"utf8\").toString(\"base64\");\n  return [{\n    json: { warning: \"No data found\" },\n    binary: { data: { data: base64, mimeType: \"text/html\", fileName: \"cari_ekstra_debug.html\" } }\n  }];\n}\n\n// --- BaÅŸlÄ±klarÄ± Ã§Ä±kar\nconst headersSet = new Set();\nitems.forEach(obj => Object.keys(obj).forEach(k => headersSet.add(k)));\nconst headers = Array.from(headersSet);\n\n// --- Her sÃ¼tun iÃ§in geniÅŸlik hesapla\nconst columnWidths = headers.map(h => {\n  let maxLen = h.length;\n  for (const item of items) {\n    const val = item[h];\n    if (val !== null && val !== undefined) {\n      maxLen = Math.max(maxLen, val.toString().length);\n    }\n  }\n  return Math.max(50, maxLen * 7);\n});\n\n// --- XML Spreadsheet baÅŸlat\nlet xml = `<?xml version=\"1.0\"?>\n<Workbook xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\n xmlns:o=\"urn:schemas-microsoft-com:office:office\"\n xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\n xmlns:ss=\"urn:schemas-microsoft-com:office:spreadsheet\">\n<Styles>\n  <Style ss:ID=\"DateStyle\">\n    <NumberFormat ss:Format=\"yyyy-mm-dd\"/>\n  </Style>\n  <Style ss:ID=\"CurrencyStyle\">\n    <NumberFormat ss:Format=\"â‚º#,##0.00\"/>\n  </Style>\n  <Style ss:ID=\"NumberStyle\">\n    <NumberFormat ss:Format=\"#,##0.00\"/>\n  </Style>\n</Styles>\n<Worksheet ss:Name=\"CariBorcAlacak\">\n<Table>`;\n\n// --- SÃ¼tun geniÅŸliklerini ekle\nfor (const w of columnWidths) {\n  xml += `<Column ss:AutoFitWidth=\"0\" ss:Width=\"${w}\"/>`;\n}\n\n// --- BaÅŸlÄ±k satÄ±rÄ±\nxml += \"<Row>\";\nfor (const h of headers) {\n  xml += `<Cell><Data ss:Type=\"String\">${xmlEscape(h)}</Data></Cell>`;\n}\nxml += \"</Row>\";\n\n// --- Veri satÄ±rlarÄ±\nfor (const item of items) {\n  xml += \"<Row>\";\n\n  for (const h of headers) {\n    let val = item[h];\n    let cellType = \"String\";\n    let style = \"\";\n\n    if (val === null || val === undefined) val = \"\";\n\n    if (typeof val === \"number\") {\n      cellType = \"Number\";\n      style = ' ss:StyleID=\"NumberStyle\"';\n    } else if (typeof val === \"string\") {\n\n      // Tarih kontrolÃ¼\n      if (h.toLowerCase().includes(\"tarih\") && /^\\d{4}-\\d{2}-\\d{2}/.test(val)) {\n        cellType = \"DateTime\";\n        style = ' ss:StyleID=\"DateStyle\"';\n        val = new Date(val).toISOString();\n      }\n\n      // Parasal deÄŸer kontrolÃ¼\n      else if ([\"tutar\",\"borÃ§\",\"borc\",\"alacak\",\"toplam\"].some(k => h.toLowerCase().includes(k))) {\n        const num = parseFloat(val.toString().replace(\",\", \".\"));\n        if (!isNaN(num)) {\n          cellType = \"Number\";\n          style = ' ss:StyleID=\"CurrencyStyle\"';\n          val = num;\n        }\n      }\n    }\n\n    // XML'e uygun ÅŸekilde hÃ¼cre yazÄ±mÄ±\n    if (cellType === \"DateTime\") {\n      xml += `<Cell${style}><Data ss:Type=\"DateTime\">${val}</Data></Cell>`;\n    } else {\n      xml += `<Cell${style}><Data ss:Type=\"${cellType}\">${xmlEscape(val)}</Data></Cell>`;\n    }\n  }\n\n  xml += \"</Row>\";\n}\n\nxml += \"</Table></Worksheet></Workbook>\";\n\n// --- Base64 encode\nconst base64 = Buffer.from(xml, \"utf8\").toString(\"base64\");\n\nreturn [{\n  json: {},\n  binary: {\n    data: {\n      data: base64,\n      mimeType: \"application/vnd.ms-excel\",\n      fileName: \"CariBorcAlacak.xls\"\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -816,
        3408
      ],
      "id": "6cc4a9a6-980b-45d7-8216-64a216a432fb",
      "name": "Excel5"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.data;\n\nlet items = [];\nif (Array.isArray(input)) {\n  items = input;\n} else if (typeof input === 'object') {\n  items = [input];\n}\n\nif (items.length === 0) {\n  const debugHtml = `<html><body><h3>Veri bulunamadÄ±</h3><pre>${JSON.stringify(input,null,2)}</pre></body></html>`;\n  const base64 = Buffer.from(debugHtml, \"utf8\").toString(\"base64\");\n  return [{\n    json: { warning: \"No data found\" },\n    binary: { data: { data: base64, mimeType: \"text/html\", fileName: \"cari_ekstra_debug.html\" } }\n  }];\n}\n\n// --- BaÅŸlÄ±klarÄ± Ã§Ä±kar\nconst headersSet = new Set();\nitems.forEach(obj => Object.keys(obj).forEach(k => headersSet.add(k)));\nconst headers = Array.from(headersSet);\n\n// --- Her sÃ¼tun iÃ§in geniÅŸlik hesapla\nconst columnWidths = headers.map(h => {\n  let maxLen = h.length;\n  for (const item of items) {\n    const val = item[h];\n    if (val !== null && val !== undefined) {\n      maxLen = Math.max(maxLen, val.toString().length);\n    }\n  }\n  return Math.max(50, maxLen * 7);\n});\n\n// --- XML Spreadsheet baÅŸlat\nlet xml = `<?xml version=\"1.0\"?>\n<Workbook xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\n xmlns:o=\"urn:schemas-microsoft-com:office:office\"\n xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\n xmlns:ss=\"urn:schemas-microsoft-com:office:spreadsheet\">\n<Styles>\n  <Style ss:ID=\"DateStyle\">\n    <NumberFormat ss:Format=\"yyyy-mm-dd\"/>\n  </Style>\n  <Style ss:ID=\"CurrencyStyle\">\n    <NumberFormat ss:Format=\"â‚º#,##0.00\"/>\n  </Style>\n  <Style ss:ID=\"NumberStyle\">\n    <NumberFormat ss:Format=\"#,##0.00\"/>\n  </Style>\n</Styles>\n<Worksheet ss:Name=\"CariEkstra\">\n<Table>`;\n\n// --- SÃ¼tun geniÅŸliklerini ekle\nfor (const w of columnWidths) {\n  xml += `<Column ss:AutoFitWidth=\"0\" ss:Width=\"${w}\"/>`;\n}\n\n// --- BaÅŸlÄ±k satÄ±rÄ±\nxml += \"<Row>\";\nfor (const h of headers) {\n  xml += `<Cell><Data ss:Type=\"String\">${h}</Data></Cell>`;\n}\nxml += \"</Row>\";\n\n// --- Veri satÄ±rlarÄ±\nfor (const item of items) {\n  xml += \"<Row>\";\n  for (const h of headers) {\n    let val = item[h];\n    let cellType = \"String\";\n    let style = \"\";\n\n    if (val === null || val === undefined) val = \"\";\n\n    if (typeof val === \"number\") {\n      cellType = \"Number\";\n      style = ' ss:StyleID=\"NumberStyle\"';\n    } else if (typeof val === \"string\") {\n      // Tarih kontrolÃ¼\n      if (h.toLowerCase().includes(\"tarih\") && /^\\d{4}-\\d{2}-\\d{2}/.test(val)) {\n        cellType = \"DateTime\";\n        style = ' ss:StyleID=\"DateStyle\"';\n        val = new Date(val).toISOString();\n      }\n      // Parasal deÄŸer kontrolÃ¼\n      else if ([\"tutar\",\"borÃ§\",\"borc\",\"alacak\",\"toplam\"].some(k => h.toLowerCase().includes(k))) {\n        const num = parseFloat(val.toString().replace(\",\", \".\"));\n        if (!isNaN(num)) {\n          cellType = \"Number\";\n          style = ' ss:StyleID=\"CurrencyStyle\"';\n          val = num;\n        }\n      }\n    }\n\n    xml += `<Cell${style}><Data ss:Type=\"${cellType}\">${val}</Data></Cell>`;\n  }\n  xml += \"</Row>\";\n}\n\nxml += \"</Table></Worksheet></Workbook>\";\n\n// --- Base64 encode\nconst base64 = Buffer.from(xml, \"utf8\").toString(\"base64\");\n\nreturn [{\n  json: {},\n  binary: {\n    data: {\n      data: base64,\n      mimeType: \"application/vnd.ms-excel\",\n      fileName: \"StokAnaliz.xls\"\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        624,
        112
      ],
      "id": "1036b663-211a-469d-958b-155fab5bab8c",
      "name": "Excel6"
    },
    {
      "parameters": {
        "name": "Stok KarlÄ±lÄ±k Analiz Raporu",
        "driveId": {
          "__rl": true,
          "value": "My Drive",
          "mode": "list",
          "cachedResultName": "My Drive",
          "cachedResultUrl": "https://drive.google.com/drive/my-drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1lokTTqz9S0jNDoibwQ4ElG5_b9pcltX2",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        816,
        112
      ],
      "id": "63c14416-5277-4806-aebf-0819b7518bee",
      "name": "excel upload7",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "iN9OE5UMYJ8poAVA",
          "name": "Ãœcretli Hesap"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Webhook1').item.json.body.instance }}",
        "remoteJid": "={{ $('Webhook1').item.json.body.data.key.remoteJid }}",
        "messageText": "={{ $('Category').item.json.category }} Raporunuz hazÄ±r. AÅŸaÄŸÄ±daki baÄŸlantÄ±dan ulaÅŸabilirsiniz.\n\n{{ $json.webViewLink }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "typeVersion": 1,
      "position": [
        976,
        112
      ],
      "id": "6fd353e3-3bc4-40a5-9519-519a74bbee41",
      "name": "Send text5",
      "credentials": {
        "evolutionApi": {
          "id": "boMU56w93xgnxgsV",
          "name": "emre"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"exec aris_stok_karlÄ±lÄ±k_analizi_exec @Ay ={{ $('Category').item.json.ay }};\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        400,
        112
      ],
      "id": "a88d6646-4093-4527-b66d-0f94de5e18fa",
      "name": "Stok KarlÄ±lÄ±k"
    },
    {
      "parameters": {
        "content": "Plasiyer Borc Alacak",
        "height": 624,
        "width": 896,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1072,
        2944
      ],
      "id": "e1d0d431-fd45-4597-8d5d-163d1c305de3",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"EXEC aris_StokDevirHizi_exec {{ $('Category').item.json.ay }}, 2025\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1024,
        -400
      ],
      "id": "5a3eb569-08dd-4e1e-8728-638b15c94887",
      "name": "Stok devir hÄ±zÄ±"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.data;\n\nlet items = [];\nif (Array.isArray(input)) {\n  items = input;\n} else if (typeof input === 'object') {\n  items = [input];\n}\n\nif (items.length === 0) {\n  const debugHtml = `<html><body><h3>Veri bulunamadÄ±</h3><pre>${JSON.stringify(input,null,2)}</pre></body></html>`;\n  const base64 = Buffer.from(debugHtml, \"utf8\").toString(\"base64\");\n  return [{\n    json: { warning: \"No data found\" },\n    binary: { data: { data: base64, mimeType: \"text/html\", fileName: \"cari_ekstra_debug.html\" } }\n  }];\n}\n\n// --- BaÅŸlÄ±klarÄ± Ã§Ä±kar\nconst headersSet = new Set();\nitems.forEach(obj => Object.keys(obj).forEach(k => headersSet.add(k)));\nconst headers = Array.from(headersSet);\n\n// --- Her sÃ¼tun iÃ§in geniÅŸlik hesapla\nconst columnWidths = headers.map(h => {\n  let maxLen = h.length;\n  for (const item of items) {\n    const val = item[h];\n    if (val !== null && val !== undefined) {\n      maxLen = Math.max(maxLen, val.toString().length);\n    }\n  }\n  return Math.max(50, maxLen * 7);\n});\n\n// --- XML Spreadsheet baÅŸlat\nlet xml = `<?xml version=\"1.0\"?>\n<Workbook xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\n xmlns:o=\"urn:schemas-microsoft-com:office:office\"\n xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\n xmlns:ss=\"urn:schemas-microsoft-com:office:spreadsheet\">\n<Styles>\n  <Style ss:ID=\"DateStyle\">\n    <NumberFormat ss:Format=\"yyyy-mm-dd\"/>\n  </Style>\n  <Style ss:ID=\"CurrencyStyle\">\n    <NumberFormat ss:Format=\"â‚º#,##0.00\"/>\n  </Style>\n  <Style ss:ID=\"NumberStyle\">\n    <NumberFormat ss:Format=\"#,##0.00\"/>\n  </Style>\n</Styles>\n<Worksheet ss:Name=\"CariEkstra\">\n<Table>`;\n\n// --- SÃ¼tun geniÅŸliklerini ekle\nfor (const w of columnWidths) {\n  xml += `<Column ss:AutoFitWidth=\"0\" ss:Width=\"${w}\"/>`;\n}\n\n// --- BaÅŸlÄ±k satÄ±rÄ±\nxml += \"<Row>\";\nfor (const h of headers) {\n  xml += `<Cell><Data ss:Type=\"String\">${h}</Data></Cell>`;\n}\nxml += \"</Row>\";\n\n// --- Veri satÄ±rlarÄ±\nfor (const item of items) {\n  xml += \"<Row>\";\n  for (const h of headers) {\n    let val = item[h];\n    let cellType = \"String\";\n    let style = \"\";\n\n    if (val === null || val === undefined) val = \"\";\n\n    if (typeof val === \"number\") {\n      cellType = \"Number\";\n      style = ' ss:StyleID=\"NumberStyle\"';\n    } else if (typeof val === \"string\") {\n      // Tarih kontrolÃ¼\n      if (h.toLowerCase().includes(\"tarih\") && /^\\d{4}-\\d{2}-\\d{2}/.test(val)) {\n        cellType = \"DateTime\";\n        style = ' ss:StyleID=\"DateStyle\"';\n        val = new Date(val).toISOString();\n      }\n      // Parasal deÄŸer kontrolÃ¼\n      else if ([\"tutar\",\"borÃ§\",\"borc\",\"alacak\",\"toplam\"].some(k => h.toLowerCase().includes(k))) {\n        const num = parseFloat(val.toString().replace(\",\", \".\"));\n        if (!isNaN(num)) {\n          cellType = \"Number\";\n          style = ' ss:StyleID=\"CurrencyStyle\"';\n          val = num;\n        }\n      }\n    }\n\n    xml += `<Cell${style}><Data ss:Type=\"${cellType}\">${val}</Data></Cell>`;\n  }\n  xml += \"</Row>\";\n}\n\nxml += \"</Table></Worksheet></Workbook>\";\n\n// --- Base64 encode\nconst base64 = Buffer.from(xml, \"utf8\").toString(\"base64\");\n\nreturn [{\n  json: {},\n  binary: {\n    data: {\n      data: base64,\n      mimeType: \"application/vnd.ms-excel\",\n      fileName: \"StokDevirHÄ±zÄ±.xls\"\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -800,
        -400
      ],
      "id": "09cf103b-a576-4b8b-9690-7545647b9f7f",
      "name": "Excel8"
    },
    {
      "parameters": {
        "name": "Stok Devir HÄ±zÄ±",
        "driveId": {
          "__rl": true,
          "value": "My Drive",
          "mode": "list",
          "cachedResultName": "My Drive",
          "cachedResultUrl": "https://drive.google.com/drive/my-drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1lokTTqz9S0jNDoibwQ4ElG5_b9pcltX2",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -624,
        -400
      ],
      "id": "5e77da5d-d85c-4714-916f-edb74ef28422",
      "name": "excel upload8",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "iN9OE5UMYJ8poAVA",
          "name": "Ãœcretli Hesap"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Webhook1').item.json.body.instance }}",
        "remoteJid": "={{ $('Webhook1').item.json.body.data.key.remoteJid }}",
        "messageText": "={{ $('Category').item.json.category }} Raporunuz hazÄ±r. AÅŸaÄŸÄ±daki baÄŸlantÄ±dan ulaÅŸabilirsiniz.\n\n{{ $json.webViewLink }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "typeVersion": 1,
      "position": [
        -448,
        -400
      ],
      "id": "2c7f3772-fc94-43d6-be56-5398543a5440",
      "name": "Send text6",
      "credentials": {
        "evolutionApi": {
          "id": "boMU56w93xgnxgsV",
          "name": "emre"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.body.data.instanceId }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -1584,
        1952
      ],
      "id": "db4fa1d3-3905-47c0-9b85-417c45a5d2b3",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "content": "Stok Devir HÄ±zÄ±",
        "height": 256,
        "width": 912,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1088,
        -464
      ],
      "id": "f25fafb6-63d4-480b-9182-a44b895f849d",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://78.189.74.41:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-0DH21PVODRP1TA5SVXWMFK2J"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"exec nsp_netsesguncelle 2, 'ys0001',1,0,'e','h','2',-1,'H',0,0,'H'\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1040,
        448
      ],
      "id": "b5e36d03-c0a6-4649-9366-cf644b122709",
      "name": "exec cÃ¼mlle"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://78.189.74.41:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-0DH21PVODRP1TA5SVXWMFK2J"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"EXEC Aris_stokFifo 'Stok_Kodu = ''AMB-02''','01/01/2025','12/31/2025','X',0.0,'E',0,0,'H','E','T',0,'H'\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -880,
        448
      ],
      "id": "9942bdf7-a64a-4ffe-a616-e6078afc32d8",
      "name": "Stok Fifo"
    },
    {
      "parameters": {
        "name": "Stok fifo",
        "driveId": {
          "__rl": true,
          "value": "My Drive",
          "mode": "list",
          "cachedResultName": "My Drive",
          "cachedResultUrl": "https://drive.google.com/drive/my-drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1lokTTqz9S0jNDoibwQ4ElG5_b9pcltX2",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -576,
        448
      ],
      "id": "2fb8ee8e-257c-499d-b69c-0f07348c67ed",
      "name": "excel upload10",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "iN9OE5UMYJ8poAVA",
          "name": "Ãœcretli Hesap"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Webhook1').item.json.body.instance }}",
        "remoteJid": "={{ $('Webhook1').item.json.body.data.key.remoteJid }}",
        "messageText": "={{ $('Category').item.json.category }} Raporunuz hazÄ±r. AÅŸaÄŸÄ±daki baÄŸlantÄ±dan ulaÅŸabilirsiniz.\n\n{{ $json.webViewLink }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "typeVersion": 1,
      "position": [
        -400,
        448
      ],
      "id": "a24e1e3b-6456-4030-8655-f043c9a4bd9a",
      "name": "Send text8",
      "credentials": {
        "evolutionApi": {
          "id": "boMU56w93xgnxgsV",
          "name": "emre"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.data;\n\n// --- XML gÃ¼venli karakter fonksiyonu\nfunction escapeXml(value) {\n  if (value === null || value === undefined) return \"\";\n  return value.toString()\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&apos;\");\n}\n\nlet items = [];\nif (Array.isArray(input)) {\n  items = input;\n} else if (typeof input === \"object\") {\n  items = [input];\n}\n\nif (items.length === 0) {\n  const debugHtml = `<html><body><h3>Veri bulunamadÄ±</h3><pre>${JSON.stringify(input,null,2)}</pre></body></html>`;\n  const base64 = Buffer.from(debugHtml, \"utf8\").toString(\"base64\");\n  return [{\n    json: { warning: \"No data found\" },\n    binary: { data: { data: base64, mimeType: \"text/html\", fileName: \"cari_ekstra_debug.html\" } }\n  }];\n}\n\n// --- BaÅŸlÄ±klarÄ± Ã§Ä±kar\nconst headersSet = new Set();\nitems.forEach(obj => Object.keys(obj).forEach(k => headersSet.add(k)));\nconst headers = Array.from(headersSet);\n\n// --- SÃ¼tun geniÅŸlik hesaplama\nconst columnWidths = headers.map(h => {\n  let maxLen = h.length;\n  for (const item of items) {\n    const val = item[h];\n    if (val !== null && val !== undefined) {\n      maxLen = Math.max(maxLen, val.toString().length);\n    }\n  }\n  return Math.max(50, maxLen * 7);\n});\n\n// --- XML Spreadsheet baÅŸlat\nlet xml = `<?xml version=\"1.0\"?>\n<Workbook xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\n xmlns:o=\"urn:schemas-microsoft-com:office:office\"\n xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\n xmlns:ss=\"urn:schemas-microsoft-com:office:spreadsheet\">\n<Styles>\n  <Style ss:ID=\"DateStyle\">\n    <NumberFormat ss:Format=\"yyyy-mm-dd\"/>\n  </Style>\n  <Style ss:ID=\"CurrencyStyle\">\n    <NumberFormat ss:Format=\"â‚º#,##0.00\"/>\n  </Style>\n  <Style ss:ID=\"NumberStyle\">\n    <NumberFormat ss:Format=\"#,##0.00\"/>\n  </Style>\n</Styles>\n<Worksheet ss:Name=\"CariEkstra\">\n<Table>`;\n\n// --- SÃ¼tun geniÅŸlikleri\nfor (const w of columnWidths) {\n  xml += `<Column ss:AutoFitWidth=\"0\" ss:Width=\"${w}\"/>`;\n}\n\n// --- BaÅŸlÄ±k satÄ±rÄ±\nxml += \"<Row>\";\nfor (const h of headers) {\n  xml += `<Cell><Data ss:Type=\"String\">${escapeXml(h)}</Data></Cell>`;\n}\nxml += \"</Row>\";\n\n// --- Veri satÄ±rlarÄ±\nfor (const item of items) {\n  xml += \"<Row>\";\n  for (const h of headers) {\n    let val = item[h];\n    let cellType = \"String\";\n    let style = \"\";\n\n    if (val === null || val === undefined) val = \"\";\n\n    if (typeof val === \"number\") {\n      cellType = \"Number\";\n      style = ' ss:StyleID=\"NumberStyle\"';\n    } else if (typeof val === \"string\") {\n      // Tarih formatÄ± (ISO)\n      if (h.toLowerCase().includes(\"tarih\") && /^\\d{4}-\\d{2}-\\d{2}/.test(val)) {\n        cellType = \"DateTime\";\n        style = ' ss:StyleID=\"DateStyle\"';\n        let d = new Date(val);\n        val = d.toISOString().replace(\"Z\", \"\"); // <-- Ã¶nemli dÃ¼zeltme\n      }\n      // Parasal deÄŸer kontrolÃ¼\n      else if ([\"tutar\",\"borÃ§\",\"borc\",\"alacak\",\"toplam\"].some(k => h.toLowerCase().includes(k))) {\n        const num = parseFloat(val.toString().replace(\",\", \".\"));\n        if (!isNaN(num)) {\n          cellType = \"Number\";\n          style = ' ss:StyleID=\"CurrencyStyle\"';\n          val = num;\n        }\n      }\n    }\n\n    xml += `<Cell${style}><Data ss:Type=\"${cellType}\">${escapeXml(val)}</Data></Cell>`;\n  }\n  xml += \"</Row>\";\n}\n\nxml += \"</Table></Worksheet></Workbook>\";\n\n// --- Base64 encode\nconst base64 = Buffer.from(xml, \"utf8\").toString(\"base64\");\n\nreturn [{\n  json: {},\n  binary: {\n    data: {\n      data: base64,\n      mimeType: \"application/vnd.ms-excel\",\n      fileName: \"StokFifo.xml\"   // <-- .xml yapÄ±ldÄ±, bozuk uyarÄ±sÄ± kalkar\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -720,
        448
      ],
      "id": "3f54fa6c-91c9-4ed4-8593-de8cb2668c54",
      "name": "Excel11"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.data;\n\n// XML iÃ§in escape fonksiyonu (EN KRÄ°TÄ°K DÃœZELTME)\nfunction xmlEscape(str) {\n  return String(str)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&apos;\");\n}\n\nlet items = [];\nif (Array.isArray(input)) {\n  items = input;\n} else if (typeof input === 'object') {\n  items = [input];\n}\n\nif (items.length === 0) {\n  const debugHtml = `<html><body><h3>Veri bulunamadÄ±</h3><pre>${xmlEscape(JSON.stringify(input,null,2))}</pre></body></html>`;\n  const base64 = Buffer.from(debugHtml, \"utf8\").toString(\"base64\");\n  return [{\n    json: { warning: \"No data found\" },\n    binary: { data: { data: base64, mimeType: \"text/html\", fileName: \"cari_ekstra_debug.html\" } }\n  }];\n}\n\n// --- BaÅŸlÄ±klarÄ± Ã§Ä±kar\nconst headersSet = new Set();\nitems.forEach(obj => Object.keys(obj).forEach(k => headersSet.add(k)));\nconst headers = Array.from(headersSet);\n\n// --- Her sÃ¼tun iÃ§in geniÅŸlik hesapla\nconst columnWidths = headers.map(h => {\n  let maxLen = h.length;\n  for (const item of items) {\n    const val = item[h];\n    if (val !== null && val !== undefined) {\n      maxLen = Math.max(maxLen, val.toString().length);\n    }\n  }\n  return Math.max(50, maxLen * 7);\n});\n\n// --- XML Spreadsheet baÅŸlat\nlet xml = `<?xml version=\"1.0\"?>\n<Workbook xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\n xmlns:o=\"urn:schemas-microsoft-com:office:office\"\n xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\n xmlns:ss=\"urn:schemas-microsoft-com:office:spreadsheet\">\n<Styles>\n  <Style ss:ID=\"DateStyle\">\n    <NumberFormat ss:Format=\"yyyy-mm-dd\"/>\n  </Style>\n  <Style ss:ID=\"CurrencyStyle\">\n    <NumberFormat ss:Format=\"â‚º#,##0.00\"/>\n  </Style>\n  <Style ss:ID=\"NumberStyle\">\n    <NumberFormat ss:Format=\"#,##0.00\"/>\n  </Style>\n</Styles>\n<Worksheet ss:Name=\"CariXyz\">\n<Table>`;\n\n// --- SÃ¼tun geniÅŸliklerini ekle\nfor (const w of columnWidths) {\n  xml += `<Column ss:AutoFitWidth=\"0\" ss:Width=\"${w}\"/>`;\n}\n\n// --- BaÅŸlÄ±k satÄ±rÄ±\nxml += \"<Row>\";\nfor (const h of headers) {\n  xml += `<Cell><Data ss:Type=\"String\">${xmlEscape(h)}</Data></Cell>`;\n}\nxml += \"</Row>\";\n\n// --- Veri satÄ±rlarÄ±\nfor (const item of items) {\n  xml += \"<Row>\";\n\n  for (const h of headers) {\n    let val = item[h];\n    let cellType = \"String\";\n    let style = \"\";\n\n    if (val === null || val === undefined) val = \"\";\n\n    if (typeof val === \"number\") {\n      cellType = \"Number\";\n      style = ' ss:StyleID=\"NumberStyle\"';\n    } else if (typeof val === \"string\") {\n\n      // Tarih kontrolÃ¼\n      if (h.toLowerCase().includes(\"tarih\") && /^\\d{4}-\\d{2}-\\d{2}/.test(val)) {\n        cellType = \"DateTime\";\n        style = ' ss:StyleID=\"DateStyle\"';\n        val = new Date(val).toISOString();\n      }\n\n      // Parasal deÄŸer kontrolÃ¼\n      else if ([\"tutar\",\"borÃ§\",\"borc\",\"alacak\",\"toplam\"].some(k => h.toLowerCase().includes(k))) {\n        const num = parseFloat(val.toString().replace(\",\", \".\"));\n        if (!isNaN(num)) {\n          cellType = \"Number\";\n          style = ' ss:StyleID=\"CurrencyStyle\"';\n          val = num;\n        }\n      }\n    }\n\n    // XML'e uygun ÅŸekilde hÃ¼cre yazÄ±mÄ±\n    if (cellType === \"DateTime\") {\n      xml += `<Cell${style}><Data ss:Type=\"DateTime\">${val}</Data></Cell>`;\n    } else {\n      xml += `<Cell${style}><Data ss:Type=\"${cellType}\">${xmlEscape(val)}</Data></Cell>`;\n    }\n  }\n\n  xml += \"</Row>\";\n}\n\nxml += \"</Table></Worksheet></Workbook>\";\n\n// --- Base64 encode\nconst base64 = Buffer.from(xml, \"utf8\").toString(\"base64\");\n\nreturn [{\n  json: {},\n  binary: {\n    data: {\n      data: base64,\n      mimeType: \"application/vnd.ms-excel\",\n      fileName: \"CariXyz.xls\"\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -176,
        1904
      ],
      "id": "757f0de4-98f1-41e2-90b5-ee520bb86989",
      "name": "Excel9"
    },
    {
      "parameters": {
        "name": "AbcXyz Cari Raporu",
        "driveId": {
          "__rl": true,
          "value": "My Drive",
          "mode": "list",
          "cachedResultName": "My Drive",
          "cachedResultUrl": "https://drive.google.com/drive/my-drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1lokTTqz9S0jNDoibwQ4ElG5_b9pcltX2",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -16,
        1904
      ],
      "id": "97874cbb-590b-49c2-ba69-b2ccd13aec08",
      "name": "excel upload9",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "iN9OE5UMYJ8poAVA",
          "name": "Ãœcretli Hesap"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"exec dbo.Aris_ABC_XYZ_Cari\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -336,
        1904
      ],
      "id": "0c7aa3e0-d838-4477-9a26-bead8f137ef7",
      "name": "carixyz"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.data;\n\n// XML iÃ§in escape fonksiyonu (EN KRÄ°TÄ°K DÃœZELTME)\nfunction xmlEscape(str) {\n  return String(str)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&apos;\");\n}\n\nlet items = [];\nif (Array.isArray(input)) {\n  items = input;\n} else if (typeof input === 'object') {\n  items = [input];\n}\n\nif (items.length === 0) {\n  const debugHtml = `<html><body><h3>Veri bulunamadÄ±</h3><pre>${xmlEscape(JSON.stringify(input,null,2))}</pre></body></html>`;\n  const base64 = Buffer.from(debugHtml, \"utf8\").toString(\"base64\");\n  return [{\n    json: { warning: \"No data found\" },\n    binary: { data: { data: base64, mimeType: \"text/html\", fileName: \"cari_ekstra_debug.html\" } }\n  }];\n}\n\n// --- BaÅŸlÄ±klarÄ± Ã§Ä±kar\nconst headersSet = new Set();\nitems.forEach(obj => Object.keys(obj).forEach(k => headersSet.add(k)));\nconst headers = Array.from(headersSet);\n\n// --- Her sÃ¼tun iÃ§in geniÅŸlik hesapla\nconst columnWidths = headers.map(h => {\n  let maxLen = h.length;\n  for (const item of items) {\n    const val = item[h];\n    if (val !== null && val !== undefined) {\n      maxLen = Math.max(maxLen, val.toString().length);\n    }\n  }\n  return Math.max(50, maxLen * 7);\n});\n\n// --- XML Spreadsheet baÅŸlat\nlet xml = `<?xml version=\"1.0\"?>\n<Workbook xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\n xmlns:o=\"urn:schemas-microsoft-com:office:office\"\n xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\n xmlns:ss=\"urn:schemas-microsoft-com:office:spreadsheet\">\n<Styles>\n  <Style ss:ID=\"DateStyle\">\n    <NumberFormat ss:Format=\"yyyy-mm-dd\"/>\n  </Style>\n  <Style ss:ID=\"CurrencyStyle\">\n    <NumberFormat ss:Format=\"â‚º#,##0.00\"/>\n  </Style>\n  <Style ss:ID=\"NumberStyle\">\n    <NumberFormat ss:Format=\"#,##0.00\"/>\n  </Style>\n</Styles>\n<Worksheet ss:Name=\"12aylÄ±knetsatÄ±s\">\n<Table>`;\n\n// --- SÃ¼tun geniÅŸliklerini ekle\nfor (const w of columnWidths) {\n  xml += `<Column ss:AutoFitWidth=\"0\" ss:Width=\"${w}\"/>`;\n}\n\n// --- BaÅŸlÄ±k satÄ±rÄ±\nxml += \"<Row>\";\nfor (const h of headers) {\n  xml += `<Cell><Data ss:Type=\"String\">${xmlEscape(h)}</Data></Cell>`;\n}\nxml += \"</Row>\";\n\n// --- Veri satÄ±rlarÄ±\nfor (const item of items) {\n  xml += \"<Row>\";\n\n  for (const h of headers) {\n    let val = item[h];\n    let cellType = \"String\";\n    let style = \"\";\n\n    if (val === null || val === undefined) val = \"\";\n\n    if (typeof val === \"number\") {\n      cellType = \"Number\";\n      style = ' ss:StyleID=\"NumberStyle\"';\n    } else if (typeof val === \"string\") {\n\n      // Tarih kontrolÃ¼\n      if (h.toLowerCase().includes(\"tarih\") && /^\\d{4}-\\d{2}-\\d{2}/.test(val)) {\n        cellType = \"DateTime\";\n        style = ' ss:StyleID=\"DateStyle\"';\n        val = new Date(val).toISOString();\n      }\n\n      // Parasal deÄŸer kontrolÃ¼\n      else if ([\"tutar\",\"borÃ§\",\"borc\",\"alacak\",\"toplam\"].some(k => h.toLowerCase().includes(k))) {\n        const num = parseFloat(val.toString().replace(\",\", \".\"));\n        if (!isNaN(num)) {\n          cellType = \"Number\";\n          style = ' ss:StyleID=\"CurrencyStyle\"';\n          val = num;\n        }\n      }\n    }\n\n    // XML'e uygun ÅŸekilde hÃ¼cre yazÄ±mÄ±\n    if (cellType === \"DateTime\") {\n      xml += `<Cell${style}><Data ss:Type=\"DateTime\">${val}</Data></Cell>`;\n    } else {\n      xml += `<Cell${style}><Data ss:Type=\"${cellType}\">${xmlEscape(val)}</Data></Cell>`;\n    }\n  }\n\n  xml += \"</Row>\";\n}\n\nxml += \"</Table></Worksheet></Workbook>\";\n\n// --- Base64 encode\nconst base64 = Buffer.from(xml, \"utf8\").toString(\"base64\");\n\nreturn [{\n  json: {},\n  binary: {\n    data: {\n      data: base64,\n      mimeType: \"application/vnd.ms-excel\",\n      fileName: \"12aylÄ±knetsatÄ±s.xls\"\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -768,
        2560
      ],
      "id": "a787bb95-047b-424d-a96a-d63e87b2bdf9",
      "name": "Excel10"
    },
    {
      "parameters": {
        "name": "12 AylÄ±k SatÄ±ÅŸ Raporu",
        "driveId": {
          "__rl": true,
          "value": "My Drive",
          "mode": "list",
          "cachedResultName": "My Drive",
          "cachedResultUrl": "https://drive.google.com/drive/my-drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1lokTTqz9S0jNDoibwQ4ElG5_b9pcltX2",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -576,
        2560
      ],
      "id": "f41255fa-2f82-4cc8-8cf0-ad6dd262ac6d",
      "name": "excel upload11",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "iN9OE5UMYJ8poAVA",
          "name": "Ãœcretli Hesap"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Webhook1').item.json.body.instance }}",
        "remoteJid": "={{ $('Webhook1').item.json.body.data.key.remoteJid }}",
        "messageText": "={{ $('Category').item.json.category }} Raporunuz hazÄ±r. AÅŸaÄŸÄ±daki baÄŸlantÄ±dan ulaÅŸabilirsiniz.\n\n{{ $json.webViewLink }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "typeVersion": 1,
      "position": [
        -416,
        2560
      ],
      "id": "5c2162f1-e177-4a7e-a389-82dbf3e16535",
      "name": "Send text7",
      "credentials": {
        "evolutionApi": {
          "id": "boMU56w93xgnxgsV",
          "name": "emre"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"EXEC Aris_12_aylik_net_satis\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -976,
        2560
      ],
      "id": "c13a9689-0b79-4477-b888-d87482fb4ce9",
      "name": "12aylÄ±ksatÄ±s"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Webhook1').item.json.body.instance }}",
        "remoteJid": "={{ $('Webhook1').item.json.body.data.key.remoteJid }}",
        "messageText": "={{ $('Category').item.json.category }}  Raporunuz hazÄ±r. AÅŸaÄŸÄ±daki baÄŸlantÄ±dan ulaÅŸabilirsiniz.\n\n{{ $json.webViewLink }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "typeVersion": 1,
      "position": [
        -368,
        3408
      ],
      "id": "b2546f73-2823-412b-a71d-3e27c52df819",
      "name": "Send text9",
      "credentials": {
        "evolutionApi": {
          "id": "boMU56w93xgnxgsV",
          "name": "emre"
        }
      }
    },
    {
      "parameters": {
        "content": "Stok Fifo",
        "height": 224,
        "width": 1632,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1088,
        400
      ],
      "id": "bd50e812-dae8-47ab-91d4-817f73b65c96",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "Faliyet",
        "height": 256,
        "width": 864
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        320,
        48
      ],
      "id": "4b8d5e19-d05a-4ef2-928b-864160ba0188",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"EXEC [dbo].[sp_YaslandirmaRaporu_PivotTarih] @baslangic_tarihi = '2024.01.01', @bitis_tarihi = '2025.20.11';\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -336,
        1744
      ],
      "id": "81db0285-5fe4-4f68-9cb0-b4a49f74067c",
      "name": "Takvim YaÅŸlandÄ±rma"
    },
    {
      "parameters": {
        "content": "KULLANILMIYOR  \nGÄ°THUB\n  https://github.com/MetronetGroup/Aris-Yalcin-Oto",
        "height": 1440,
        "width": 2480,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1136,
        -720
      ],
      "id": "d8ce57ff-c52f-458c-8d0b-aefc0f47f012",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Webhook1').item.json.body.instance }}",
        "remoteJid": "={{ $('Webhook1').item.json.body.data.key.remoteJid }}",
        "messageText": "={{ $json.message }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "typeVersion": 1,
      "position": [
        -912,
        1808
      ],
      "id": "dbfa440e-8799-4c36-be6f-a4a12714e0ba",
      "name": "Category MesajÄ±",
      "credentials": {
        "evolutionApi": {
          "id": "boMU56w93xgnxgsV",
          "name": "emre"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Webhook'tan gelen output (string halinde)\nconst rawOutput = $input.first().json.output;\n\nlet category = null;\nlet ay = null;\nlet message = null;\n\n// 1) Ä°Ã§indeki JSON'Ä± REGEX ile yakala\nconst jsonMatch = rawOutput.match(/\\{[\\s\\S]*?\\}/);\n\nif (jsonMatch) {\n  try {\n    const parsed = JSON.parse(jsonMatch[0]);\n    category = parsed.category ?? null;\n    ay = parsed.ay ?? null;\n    message = parsed.mesaj ?? null;\n  } catch (e) {\n    message = \"JSON parse hatasÄ±: \" + e.message;\n  }\n}\n\n// 2) JSON dÄ±ÅŸÄ±ndaki METNÄ° bul\nlet outsideText = rawOutput.replace(jsonMatch ? jsonMatch[0] : \"\", \"\").trim();\n\n// EÄŸer JSON iÃ§indeki message yoksa dÄ±ÅŸ metni kullan\nif (!message && outsideText) {\n  message = outsideText;\n}\n\n// 3) SonuÃ§ dÃ¶ndÃ¼r\nreturn [\n  {\n    category,\n    ay,\n    message\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1424,
        1712
      ],
      "id": "da76a370-3b01-461e-97c7-7edd3f135f4a",
      "name": "Category"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "bb8abb46-5965-4748-9382-e3365fa5dd9f",
              "leftValue": "={{ $json.body.data.key.fromMe }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1984,
        1696
      ],
      "id": "8be74757-4e6a-42ed-a523-89554224d229",
      "name": "FormMe"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Webhook1').item.json.body.instance }}",
        "remoteJid": "={{ $('Webhook1').item.json.body.data.key.remoteJid }}",
        "messageText": "={{ $('Category').item.json.category }} Raporunuz hazÄ±r. AÅŸaÄŸÄ±daki baÄŸlantÄ±dan ulaÅŸabilirsiniz.\n\n{{ $json.webViewLink }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "typeVersion": 1,
      "position": [
        144,
        1904
      ],
      "id": "8a7ee636-5664-4aa2-89ca-19c4916e3d3f",
      "name": "CariXyz",
      "credentials": {
        "evolutionApi": {
          "id": "boMU56w93xgnxgsV",
          "name": "emre"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.data;\n\n// XML iÃ§in escape fonksiyonu (EN KRÄ°TÄ°K DÃœZELTME)\nfunction xmlEscape(str) {\n  return String(str)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&apos;\");\n}\n\nlet items = [];\nif (Array.isArray(input)) {\n  items = input;\n} else if (typeof input === 'object') {\n  items = [input];\n}\n\nif (items.length === 0) {\n  const debugHtml = `<html><body><h3>Veri bulunamadÄ±</h3><pre>${xmlEscape(JSON.stringify(input,null,2))}</pre></body></html>`;\n  const base64 = Buffer.from(debugHtml, \"utf8\").toString(\"base64\");\n  return [{\n    json: { warning: \"No data found\" },\n    binary: { data: { data: base64, mimeType: \"text/html\", fileName: \"cari_ekstra_debug.html\" } }\n  }];\n}\n\n// --- BaÅŸlÄ±klarÄ± Ã§Ä±kar\nconst headersSet = new Set();\nitems.forEach(obj => Object.keys(obj).forEach(k => headersSet.add(k)));\nconst headers = Array.from(headersSet);\n\n// --- Her sÃ¼tun iÃ§in geniÅŸlik hesapla\nconst columnWidths = headers.map(h => {\n  let maxLen = h.length;\n  for (const item of items) {\n    const val = item[h];\n    if (val !== null && val !== undefined) {\n      maxLen = Math.max(maxLen, val.toString().length);\n    }\n  }\n  return Math.max(50, maxLen * 7);\n});\n\n// --- XML Spreadsheet baÅŸlat\nlet xml = `<?xml version=\"1.0\"?>\n<Workbook xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\n xmlns:o=\"urn:schemas-microsoft-com:office:office\"\n xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\n xmlns:ss=\"urn:schemas-microsoft-com:office:spreadsheet\">\n<Styles>\n  <Style ss:ID=\"DateStyle\">\n    <NumberFormat ss:Format=\"yyyy-mm-dd\"/>\n  </Style>\n  <Style ss:ID=\"CurrencyStyle\">\n    <NumberFormat ss:Format=\"â‚º#,##0.00\"/>\n  </Style>\n  <Style ss:ID=\"NumberStyle\">\n    <NumberFormat ss:Format=\"#,##0.00\"/>\n  </Style>\n</Styles>\n<Worksheet ss:Name=\"NakitAkÄ±s\">\n<Table>`;\n\n// --- SÃ¼tun geniÅŸliklerini ekle\nfor (const w of columnWidths) {\n  xml += `<Column ss:AutoFitWidth=\"0\" ss:Width=\"${w}\"/>`;\n}\n\n// --- BaÅŸlÄ±k satÄ±rÄ±\nxml += \"<Row>\";\nfor (const h of headers) {\n  xml += `<Cell><Data ss:Type=\"String\">${xmlEscape(h)}</Data></Cell>`;\n}\nxml += \"</Row>\";\n\n// --- Veri satÄ±rlarÄ±\nfor (const item of items) {\n  xml += \"<Row>\";\n\n  for (const h of headers) {\n    let val = item[h];\n    let cellType = \"String\";\n    let style = \"\";\n\n    if (val === null || val === undefined) val = \"\";\n\n    if (typeof val === \"number\") {\n      cellType = \"Number\";\n      style = ' ss:StyleID=\"NumberStyle\"';\n    } else if (typeof val === \"string\") {\n\n      // Tarih kontrolÃ¼\n      if (h.toLowerCase().includes(\"tarih\") && /^\\d{4}-\\d{2}-\\d{2}/.test(val)) {\n        cellType = \"DateTime\";\n        style = ' ss:StyleID=\"DateStyle\"';\n        val = new Date(val).toISOString();\n      }\n\n      // Parasal deÄŸer kontrolÃ¼\n      else if ([\"tutar\",\"borÃ§\",\"borc\",\"alacak\",\"toplam\"].some(k => h.toLowerCase().includes(k))) {\n        const num = parseFloat(val.toString().replace(\",\", \".\"));\n        if (!isNaN(num)) {\n          cellType = \"Number\";\n          style = ' ss:StyleID=\"CurrencyStyle\"';\n          val = num;\n        }\n      }\n    }\n\n    // XML'e uygun ÅŸekilde hÃ¼cre yazÄ±mÄ±\n    if (cellType === \"DateTime\") {\n      xml += `<Cell${style}><Data ss:Type=\"DateTime\">${val}</Data></Cell>`;\n    } else {\n      xml += `<Cell${style}><Data ss:Type=\"${cellType}\">${xmlEscape(val)}</Data></Cell>`;\n    }\n  }\n\n  xml += \"</Row>\";\n}\n\nxml += \"</Table></Worksheet></Workbook>\";\n\n// --- Base64 encode\nconst base64 = Buffer.from(xml, \"utf8\").toString(\"base64\");\n\nreturn [{\n  json: {},\n  binary: {\n    data: {\n      data: base64,\n      mimeType: \"application/vnd.ms-excel\",\n      fileName: \"NakitAkÄ±s.xls\"\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -192,
        2080
      ],
      "id": "5a467e37-11f5-4ade-92b5-7e68f65bbf80",
      "name": "Excel12"
    },
    {
      "parameters": {
        "name": "Nakit AkÄ±ÅŸ",
        "driveId": {
          "__rl": true,
          "value": "My Drive",
          "mode": "list",
          "cachedResultName": "My Drive",
          "cachedResultUrl": "https://drive.google.com/drive/my-drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1lokTTqz9S0jNDoibwQ4ElG5_b9pcltX2",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -32,
        2080
      ],
      "id": "bb90ba39-3ba7-49b4-bc68-3bb770cfa3fb",
      "name": "excel upload12",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "iN9OE5UMYJ8poAVA",
          "name": "Ãœcretli Hesap"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"EXEC Aris_nakitakis @cari_kodu = NULL, @baslangic_tarihi = '2024-01-01'\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -336,
        2080
      ],
      "id": "ec05d8af-583b-4193-a9e5-4cefa88a3d35",
      "name": "Nakit AkÄ±ÅŸ"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Webhook1').item.json.body.instance }}",
        "remoteJid": "={{ $('Webhook1').item.json.body.data.key.remoteJid }}",
        "messageText": "={{ $('Category').item.json.category }} Raporunuz hazÄ±r. AÅŸaÄŸÄ±daki baÄŸlantÄ±dan ulaÅŸabilirsiniz.\n\n{{ $json.webViewLink }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "typeVersion": 1,
      "position": [
        144,
        2080
      ],
      "id": "37eadc87-fa0a-4a63-98a8-1bd9a88a5c53",
      "name": "NakitAkÄ±s",
      "credentials": {
        "evolutionApi": {
          "id": "boMU56w93xgnxgsV",
          "name": "emre"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.data;\n\n// XML iÃ§in escape fonksiyonu (EN KRÄ°TÄ°K DÃœZELTME)\nfunction xmlEscape(str) {\n  return String(str)\n    .replace(/&/g, \"&amp;\")\n    .replace(/</g, \"&lt;\")\n    .replace(/>/g, \"&gt;\")\n    .replace(/\"/g, \"&quot;\")\n    .replace(/'/g, \"&apos;\");\n}\n\nlet items = [];\nif (Array.isArray(input)) {\n  items = input;\n} else if (typeof input === 'object') {\n  items = [input];\n}\n\nif (items.length === 0) {\n  const debugHtml = `<html><body><h3>Veri bulunamadÄ±</h3><pre>${xmlEscape(JSON.stringify(input,null,2))}</pre></body></html>`;\n  const base64 = Buffer.from(debugHtml, \"utf8\").toString(\"base64\");\n  return [{\n    json: { warning: \"No data found\" },\n    binary: { data: { data: base64, mimeType: \"text/html\", fileName: \"cari_ekstra_debug.html\" } }\n  }];\n}\n\n// --- BaÅŸlÄ±klarÄ± Ã§Ä±kar\nconst headersSet = new Set();\nitems.forEach(obj => Object.keys(obj).forEach(k => headersSet.add(k)));\nconst headers = Array.from(headersSet);\n\n// --- Her sÃ¼tun iÃ§in geniÅŸlik hesapla\nconst columnWidths = headers.map(h => {\n  let maxLen = h.length;\n  for (const item of items) {\n    const val = item[h];\n    if (val !== null && val !== undefined) {\n      maxLen = Math.max(maxLen, val.toString().length);\n    }\n  }\n  return Math.max(50, maxLen * 7);\n});\n\n// --- XML Spreadsheet baÅŸlat\nlet xml = `<?xml version=\"1.0\"?>\n<Workbook xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\n xmlns:o=\"urn:schemas-microsoft-com:office:office\"\n xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\n xmlns:ss=\"urn:schemas-microsoft-com:office:spreadsheet\">\n<Styles>\n  <Style ss:ID=\"DateStyle\">\n    <NumberFormat ss:Format=\"yyyy-mm-dd\"/>\n  </Style>\n  <Style ss:ID=\"CurrencyStyle\">\n    <NumberFormat ss:Format=\"â‚º#,##0.00\"/>\n  </Style>\n  <Style ss:ID=\"NumberStyle\">\n    <NumberFormat ss:Format=\"#,##0.00\"/>\n  </Style>\n</Styles>\n<Worksheet ss:Name=\"SipariÅŸ Ã–neri Raporu\">\n<Table>`;\n\n// --- SÃ¼tun geniÅŸliklerini ekle\nfor (const w of columnWidths) {\n  xml += `<Column ss:AutoFitWidth=\"0\" ss:Width=\"${w}\"/>`;\n}\n\n// --- BaÅŸlÄ±k satÄ±rÄ±\nxml += \"<Row>\";\nfor (const h of headers) {\n  xml += `<Cell><Data ss:Type=\"String\">${xmlEscape(h)}</Data></Cell>`;\n}\nxml += \"</Row>\";\n\n// --- Veri satÄ±rlarÄ±\nfor (const item of items) {\n  xml += \"<Row>\";\n\n  for (const h of headers) {\n    let val = item[h];\n    let cellType = \"String\";\n    let style = \"\";\n\n    if (val === null || val === undefined) val = \"\";\n\n    if (typeof val === \"number\") {\n      cellType = \"Number\";\n      style = ' ss:StyleID=\"NumberStyle\"';\n    } else if (typeof val === \"string\") {\n\n      // Tarih kontrolÃ¼\n      if (h.toLowerCase().includes(\"tarih\") && /^\\d{4}-\\d{2}-\\d{2}/.test(val)) {\n        cellType = \"DateTime\";\n        style = ' ss:StyleID=\"DateStyle\"';\n        val = new Date(val).toISOString();\n      }\n\n      // Parasal deÄŸer kontrolÃ¼\n      else if ([\"tutar\",\"borÃ§\",\"borc\",\"alacak\",\"toplam\"].some(k => h.toLowerCase().includes(k))) {\n        const num = parseFloat(val.toString().replace(\",\", \".\"));\n        if (!isNaN(num)) {\n          cellType = \"Number\";\n          style = ' ss:StyleID=\"CurrencyStyle\"';\n          val = num;\n        }\n      }\n    }\n\n    // XML'e uygun ÅŸekilde hÃ¼cre yazÄ±mÄ±\n    if (cellType === \"DateTime\") {\n      xml += `<Cell${style}><Data ss:Type=\"DateTime\">${val}</Data></Cell>`;\n    } else {\n      xml += `<Cell${style}><Data ss:Type=\"${cellType}\">${xmlEscape(val)}</Data></Cell>`;\n    }\n  }\n\n  xml += \"</Row>\";\n}\n\nxml += \"</Table></Worksheet></Workbook>\";\n\n// --- Base64 encode\nconst base64 = Buffer.from(xml, \"utf8\").toString(\"base64\");\n\nreturn [{\n  json: {},\n  binary: {\n    data: {\n      data: base64,\n      mimeType: \"application/vnd.ms-excel\",\n      fileName: \"SipariÅŸ Ã–neri Raporu.xls\"\n    }\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -192,
        1584
      ],
      "id": "aa7c6cc4-728c-40f6-8e94-a2c3eb9b0e16",
      "name": "Excel13"
    },
    {
      "parameters": {
        "name": "SipariÅŸ Ã–neri Raporu ",
        "driveId": {
          "__rl": true,
          "value": "My Drive",
          "mode": "list",
          "cachedResultName": "My Drive",
          "cachedResultUrl": "https://drive.google.com/drive/my-drive"
        },
        "folderId": {
          "__rl": true,
          "value": "1lokTTqz9S0jNDoibwQ4ElG5_b9pcltX2",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -32,
        1584
      ],
      "id": "8a1dac0d-be91-4952-aede-ed1f2f005c91",
      "name": "excel upload13",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "iN9OE5UMYJ8poAVA",
          "name": "Ãœcretli Hesap"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://193.168.153.43:6089/execute",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "RMX-HIEHWT2OF7BSGFX9MD7D565T"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"reportName\": \"Ã–zel Rapor\",\n  \"query\": \"EXEC Aris_5Aylik_SiparisOnerisi\",\n  \"parameters\": {}\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -336,
        1584
      ],
      "id": "a7e30a98-472c-418a-a5d7-28708d45f0f5",
      "name": "Siparis Ã–nerisi"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('Webhook1').item.json.body.instance }}",
        "remoteJid": "={{ $('Webhook1').item.json.body.data.key.remoteJid }}",
        "messageText": "={{ $('Category').item.json.category }} Raporunuz hazÄ±r. AÅŸaÄŸÄ±daki baÄŸlantÄ±dan ulaÅŸabilirsiniz.\n\n{{ $json.webViewLink }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api-en.evolutionApi",
      "typeVersion": 1,
      "position": [
        144,
        1584
      ],
      "id": "7f9b3e35-237e-4d4c-8720-0af6513f7801",
      "name": "SipariÅŸ Ã–nerisi",
      "credentials": {
        "evolutionApi": {
          "id": "boMU56w93xgnxgsV",
          "name": "emre"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Category",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Data Parse": {
      "main": [
        [
          {
            "node": "Excel1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "abcxyz",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Siparis Ã–nerisi",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Takvim YaÅŸlandÄ±rma",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Ã¶deme/tahsilat",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cari Hareketlerindeki plasiyere gÃ¶re",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cari Kartdaki tanÄ±mlÄ± plasiyere gÃ¶re",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cari BorÃ§ Alacak",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "carixyz",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "12aylÄ±ksatÄ±s",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Nakit AkÄ±ÅŸ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Excel1": {
      "main": [
        [
          {
            "node": "excel upload1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "excel upload1": {
      "main": [
        [
          {
            "node": "YAÅLANDIRMA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook1": {
      "main": [
        [
          {
            "node": "FormMe",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "abcxyz": {
      "main": [
        [
          {
            "node": "Excel",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Excel": {
      "main": [
        [
          {
            "node": "excel upload",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "excel upload": {
      "main": [
        [
          {
            "node": "ABC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Banka Bakiye": {
      "main": [
        [
          {
            "node": "mcekportfoy",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "mcektahsil": {
      "main": [
        [
          {
            "node": "msenetportfoy",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "msenetportfoy": {
      "main": [
        [
          {
            "node": "msenettahsil",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "msenettahsil": {
      "main": [
        [
          {
            "node": "AlÄ±cÄ±larbakiye",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AlÄ±cÄ±larbakiye": {
      "main": [
        [
          {
            "node": "SatÄ±cÄ±caribakiye",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SatÄ±cÄ±caribakiye": {
      "main": [
        [
          {
            "node": "Kasa Kalan",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ä°Ã§erik DÃ¼zenleme": {
      "main": [
        [
          {
            "node": "Whatsapp Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Whatsapp Message": {
      "main": [
        [
          {
            "node": "Faliyet Raporu SonuÃ§ GÃ¶nderme",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Kasa Kalan": {
      "main": [
        [
          {
            "node": "KrediKartÄ±BAKIYE",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "KrediKartÄ±BAKIYE": {
      "main": [
        [
          {
            "node": "mcek_bekleyen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "mcek_bekleyen": {
      "main": [
        [
          {
            "node": "KDV dahil genel toplam",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "KDV dahil genel toplam": {
      "main": [
        [
          {
            "node": "Ä°Ã§erik DÃ¼zenleme",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PlasiyerAylÄ±kSatÄ±sRaporu": {
      "main": [
        [
          {
            "node": "Excel2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Excel2": {
      "main": [
        [
          {
            "node": "excel upload2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "excel upload2": {
      "main": [
        [
          {
            "node": "Send text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "mcekportfoy": {
      "main": [
        [
          {
            "node": "mcektahsil",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Merhaba MesajÄ±",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Category MesajÄ±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Excel3": {
      "main": [
        [
          {
            "node": "excel upload3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "excel upload3": {
      "main": [
        [
          {
            "node": "Send text1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ã¶deme/tahsilat": {
      "main": [
        [
          {
            "node": "Excel3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cari Kartdaki tanÄ±mlÄ± plasiyere gÃ¶re": {
      "main": [
        [
          {
            "node": "Excel4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cari Hareketlerindeki plasiyere gÃ¶re": {
      "main": [
        [
          {
            "node": "Excel7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cari BorÃ§ Alacak": {
      "main": [
        [
          {
            "node": "Excel5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Excel4": {
      "main": [
        [
          {
            "node": "excel upload4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "excel upload4": {
      "main": [
        [
          {
            "node": "Send text2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "excel upload5": {
      "main": [
        [
          {
            "node": "Send text3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "excel upload6": {
      "main": [
        [
          {
            "node": "Send text9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Excel7": {
      "main": [
        [
          {
            "node": "excel upload5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Excel5": {
      "main": [
        [
          {
            "node": "excel upload6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Excel6": {
      "main": [
        [
          {
            "node": "excel upload7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "excel upload7": {
      "main": [
        [
          {
            "node": "Send text5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Stok KarlÄ±lÄ±k": {
      "main": [
        [
          {
            "node": "Excel6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Stok devir hÄ±zÄ±": {
      "main": [
        [
          {
            "node": "Excel8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Excel8": {
      "main": [
        [
          {
            "node": "excel upload8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "excel upload8": {
      "main": [
        [
          {
            "node": "Send text6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "exec cÃ¼mlle": {
      "main": [
        [
          {
            "node": "Stok Fifo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Stok Fifo": {
      "main": [
        [
          {
            "node": "Excel11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "excel upload10": {
      "main": [
        [
          {
            "node": "Send text8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send text8": {
      "main": [
        []
      ]
    },
    "Excel11": {
      "main": [
        [
          {
            "node": "excel upload10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Excel9": {
      "main": [
        [
          {
            "node": "excel upload9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "excel upload9": {
      "main": [
        [
          {
            "node": "CariXyz",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "carixyz": {
      "main": [
        [
          {
            "node": "Excel9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Excel10": {
      "main": [
        [
          {
            "node": "excel upload11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "excel upload11": {
      "main": [
        [
          {
            "node": "Send text7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "12aylÄ±ksatÄ±s": {
      "main": [
        [
          {
            "node": "Excel10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Takvim YaÅŸlandÄ±rma": {
      "main": [
        [
          {
            "node": "Data Parse",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Category MesajÄ±": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Category": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FormMe": {
      "main": [
        [],
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Excel12": {
      "main": [
        [
          {
            "node": "excel upload12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "excel upload12": {
      "main": [
        [
          {
            "node": "NakitAkÄ±s",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Nakit AkÄ±ÅŸ": {
      "main": [
        [
          {
            "node": "Excel12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Excel13": {
      "main": [
        [
          {
            "node": "excel upload13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "excel upload13": {
      "main": [
        [
          {
            "node": "SipariÅŸ Ã–nerisi",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Siparis Ã–nerisi": {
      "main": [
        [
          {
            "node": "Excel13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "df4caf53-d53f-4b83-be9f-230dd60285da",
  "meta": {
    "instanceId": "7a2a25a1f29ba61e7462cc2530df12acff17e658d10db3b4d31008d6225b17a4"
  },
  "id": "26xk5ckA8fZeeqzy",
  "tags": []
}